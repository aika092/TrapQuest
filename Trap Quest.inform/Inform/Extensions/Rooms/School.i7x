School by Rooms begins here.

An academic room is a kind of room. An academic room has a labyrinth shape called shape. The shape of an academic room is usually L5/0-0-1-1-1-1. The grid position of an academic room is usually <0,0,0>.
A academic room is usually pinned.[These rooms are always in the same place.]
A room can be lecture. [It's a classroom]
To decide which number is the entry-rank of (R - a room):
	decide on 0.

Definition: an academic room (called R) is within vision:
	now neighbour finder is the location of the player;
	if R is neighbour finder or ((armband is worn or the rank of the player >= the entry-rank of R) and R is next door), decide yes;
	decide no.

To say SchoolHallway:
	say "An identical tiled marble floor to all the other sections of hallway. ".

School01 is an academic room. The printed name of School01 is "Reception". "A receptionist's desk occupies the right hand side of this room. [one of]It looks like there[or]There[stopping] is a hallway to the north.". The shape of School01 is L5/0-0-1-0-0-0. The grid position of School01 is <5,12,5>.

[Main Hallway]
School02 is an academic room. The printed name of School02 is "Hallway". "The tiled marble floor has a large engraving in it which reads 'DISCE PER HOC QUOD LUXURIA' along with a great emblem made of a pair of bare breasts. To the south the door says 'Reception' and to the north the door says 'Food Hall'. The hallway continues for quite a distance to both the east and west.". The shape of School02 is L5/0-0-1-1-1-1. The grid position of School02 is <5,12,6>. School02 is north of School01.
School03 is an academic room. The printed name of School03 is "Hallway". "[SchoolHallway]To the south the door says 'Sewing Room' and to the north the door says 'Emerald Class'. The hallway continues for quite a distance to both the east and west.". The shape of School03 is L5/0-0-1-1-1-1. The grid position of School03 is <5,11,6>. School03 is west of School02.
School04 is an academic room. The printed name of School04 is "Hallway". "[SchoolHallway]To the south the door says 'Head Office' and to the north the door says 'Changing Rooms'. The hallway continues for quite a distance to both the east and west.". The shape of School04 is L5/0-0-1-1-1-1. The grid position of School04 is <5,10,6>. School04 is west of School03.
School05 is an academic room. The printed name of School05 is "Hallway". "[SchoolHallway]To the south the door says 'Toilets' and to the north the door says 'Assembly Hall'. The hallway continues for quite a distance to both the east and west.". The shape of School05 is L5/0-0-1-1-1-1. The grid position of School05 is <5,13,6>. School05 is east of School02.
School06 is an academic room. The printed name of School06 is "Hallway". "[SchoolHallway]To the south the door says 'Nurse's Office' and to the north the door says 'Junk Room'. The hallway continues for quite a distance to the east and a bit further to the west.". The shape of School06 is L5/0-0-1-1-1-1. The grid position of School06 is <5,14,6>. School06 is east of School05.
School07 is an academic room. The printed name of School07 is "Hallway". "[SchoolHallway]To the south the door says 'Detention Room' and to the north the door says 'Sapphire Class'. The hallway continues for quite a distance to the east[if the room east from School07 is School33]. A hidden extension to the hallway has been revealed via a door-shaped hole in the wall to the west[end if].". The shape of School07 is L5/0-0-1-0-1-1. The grid position of School07 is <5,15,6>. School07 is east of School06.

[Rooms Below Main Hallway]
School08 is an important academic room. The printed name of School08 is "Head Office". "In this room a large expensive wooden desk sits between the door and a cream armchair that has back cushions shaped like breasts and female legs coming out of the arms, making it almost feel like the chair... used to be a person. A safe in the corner looks like it must contain something valuable.". The shape of School08 is L5/0-0-1-0-0-0. The grid position of School08 is <5,10,5>. School08 is south of School04.
School09 is an academic room. The printed name of School09 is "Sewing Room". "Fabric scissors, sewing machines, and more. This room has everything you would need to mend damaged clothing.". The shape of School09 is L5/0-0-1-0-0-0. The grid position of School09 is <5,11,5>. School09 is south of School03.
To decide which number is the entry-rank of (R - School09):
	decide on 2.
School10 is an academic room. The printed name of School10 is "Toilets". "A standard set of cubicles with toilets inside, except there are no doors on the cubicles, so if anyone walked in they'd be able to see you straight away.". The shape of School10 is L5/0-0-1-0-0-0. The grid position of School10 is <5,13,5>. School10 is south of School05. School10 is toilets.
School11 is an academic room. The printed name of School11 is "Nurse's Office". "A series of medical implements ranging from enema kits to speculums hang around the walls. The entire floor of the room is empty due to a rather concerning lack of furniture. A door to the south says 'Med Bay'.". The shape of School11 is L5/0-0-1-0-1-0. The grid position of School11 is <5,14,5>. School11 is south of School06.
To decide which number is the entry-rank of (R - School11):
	decide on 1.
School12 is an academic room. The printed name of School12 is "Med Bay". "This room has a bed with pink bedsheets in it, but it doesn't look like the primary purpose of it is resting. The facts that the bed is on wheels and there are strong leather bonds at the four corners as well as several straps over the middle, bring two very specific words to your mind: '[if diaper quest is 1]Psych Ward'[otherwise]Operating Table'[end if].". The shape of School12 is L5/0-0-1-0-0-0. The grid position of School12 is <5,14,4>. School12 is south of School11.
To decide which number is the entry-rank of (R - School12):
	decide on 1.
School13 is an academic room. The printed name of School13 is "Detention Room". "This room has more than one rather sinister-looking pieces of equipment that could be used to punish a student. There's a blackboard for lines, there's a set of stocks facing the doorway, and in one corner there's a chair with waiting bondage straps on each leg, and a vibrating wand fixed through a hole in the middle.". The shape of School13 is L5/0-0-1-0-0-0. The grid position of School13 is <5,15,5>. School13 is south of School07.

[Rooms Above Main Hallway]
School14 is a lecture academic room. The printed name of School14 is "Sapphire Classroom". "This 'classroom' has rows of desks but no chairs. The walls are adorned with motifs of high heels and pouting lips.". The shape of School14 is L5/0-0-0-0-1-0. The grid position of School14 is <5,15,7>. School14 is north of School07.
To decide which number is the entry-rank of (R - School14):
	decide on 1.
School15 is an academic room. The printed name of School15 is "Junk Room". "This room has a few items of clothing discarded rather messily all around. Weird mystic runes adorn the ceiling and doorway, [if the donations of School15 < 5]pulsing a powerful purple, [end if]suggesting that some kind of magic is in action here. A door at the north end of the room says 'Science Lab'". The shape of School15 is L5/0-0-1-0-1-0. The grid position of School15 is <5,14,7>. School15 is north of School06.
To decide which number is the entry-rank of (R - School15):
	decide on 2.
School16 is an academic room. The printed name of School16 is "Assembly Hall". "A raised podium with a microphone at the front of the room makes it clear that this is an assembly hall, but the lack of other furniture makes it seem rather eerie and... clinical.". The shape of School16 is L5/0-0-0-0-1-0. The grid position of School16 is <5,13,7>. School16 is north of School05.
School17 is an academic room. The printed name of School17 is "Food Hall". "This room has large machine taking up most of the room with [ExamineDesc of food machine]". The shape of School17 is L5/0-0-1-0-1-0. The grid position of School17 is <5,12,7>. School17 is north of School02.
Definition: School17 is foody: decide yes. [Does this room remind the player that they're feeling hungry?]
School18 is a lecture academic room. The printed name of School18 is "Emerald Classroom". "This 'classroom' has rows of desks but no chairs. The walls are adorned with motifs of spanking equipment, bondage and fetishwear.". The shape of School18 is L5/0-0-0-0-1-0. The grid position of School18 is <5,11,7>. School18 is north of School03.
To decide which number is the entry-rank of (R - School18):
	decide on 2.
School19 is an itemstatic academic room. The printed name of School19 is "Changing Rooms". "This room has a few hooks to hang up clothing and not much else. A door to the west says 'Swimming Pool' on it[if gloryhole is in School19]. You blink in surprise as you look at the north wall. [ExamineDesc of gloryhole]Considering the nature of this school, it doesn't feel particularly out of place[end if].". The shape of School19 is L5/0-0-0-0-1-1. The grid position of School19 is <5,10,7>. School19 is north of School04.
To decide which number is the entry-rank of (R - School19):
	decide on 1.

[Rooms To The Left of Changing Room]
School20 is a water-bodied academic room. The printed name of School20 is "Swimming Pool". "A medium sized rectangular swimming pool [if diaper quest is 0]filled to the brim with what appears to be fresh warm [semen][otherwise]fills the air with the smell of chlorine[end if]. To the north is a set of tiered spectator stands. To the west a door reads 'Hot Tub'. To the south the door says 'Gymnasium'.". The shape of School20 is L5/0-0-1-1-1-1. The grid position of School20 is <5,9,7>. School20 is west of School19.
To decide which number is the entry-rank of (R - School20):
	decide on 2.
School21 is a water-bodied academic room. The printed name of School21 is "Hot Tub". "A large jacuzzi sits bubbling away at the centre of this otherwise small and empty room.". The shape of School21 is L5/0-0-0-1-0-0. The grid position of School21 is <5,8,7>. School21 is west of School20.
To decide which number is the entry-rank of (R - School21):
	decide on 3.
School22 is an academic room. The printed name of School22 is "Spectator Stands". "Tiered viewing benches face the [if diaper quest is 0][semen]-filled [end if]swimming pool.". The shape of School22 is L5/0-0-0-0-1-0. The grid position of School22 is <5,9,8>. School22 is north of School20.
To decide which number is the entry-rank of (R - School22):
	decide on 2.
School23 is an itemstatic academic room. The printed name of School23 is "Gym". "A large empty space typical of a school indoor gym, with the addition of racetrack markings around the outside.". The shape of School23 is L5/0-0-1-0-0-0. The grid position of School23 is <5,9,6>. School23 is south of School20.
To decide which number is the entry-rank of (R - School23):
	decide on 2.

[Upper Hallway]
School24 is an academic room. The printed name of School24 is "Hallway". "The tiled marble floor has a large engraving in it which reads 'DISCE PER HOC QUOD LUXURIA' along with a great emblem made of a pair of bare breasts. To the south the door says 'Food Hall' and to the north the door says 'Trophy Hall'. The hallway continues for a short distance to both the east and west.". The shape of School24 is L5/0-0-1-1-1-1. The grid position of School24 is <5,12,8>. School24 is north of School17.
To decide which number is the entry-rank of (R - School24):
	decide on 3.
School25 is an academic room. The printed name of School25 is "Hallway". "The tiled marble floor has a large engraving in it which reads 'DISCE PER HOC QUOD LUXURIA' along with a great emblem made of a pair of bare breasts. To the east the door says 'Science Lab' and to the north the door says 'Pink Diamond Class'. The hallway continues for a reasonable distance to the west.". The shape of School25 is L5/0-0-1-1-0-1. The grid position of School25 is <5,13,8>. School25 is east of School24.
To decide which number is the entry-rank of (R - School25):
	decide on 3.
School26 is an academic room. The printed name of School26 is "Hallway". "The tiled marble floor has a large engraving in it which reads 'DISCE PER HOC QUOD LUXURIA' along with a great emblem made of a pair of bare breasts. To the west the door says 'Staff Room' and to the north the door says 'Ruby Class'. The hallway continues for a reasonable distance to the east.". The shape of School26 is L5/0-0-1-1-0-1. The grid position of School26 is <5,11,8>. School26 is west of School24.
To decide which number is the entry-rank of (R - School26):
	decide on 3.

[Rooms Adjacent to Upper Hallway]
School27 is an academic room. The printed name of School27 is "Staff Room". "This doesn't look like any staff room you've ever seen before. [if retiredStudents > 0]A number of pieces of diapered human furniture can be found here. It truly is a unique sight to behold.[otherwise if diaper quest is 1]There's nothing here...[otherwise]Instead of any furniture there's just video cameras, piercing and tattoo needles held on giant robotic arms all poised and ready, pointing at... a gloryhole?![end if]". The shape of School27 is L5/0-0-0-1-0-0. The grid position of School27 is <5,10,8>. School27 is west of School26.
To decide which number is the entry-rank of (R - School27):
	decide on 6.
Definition: School27 (called R) is within vision:
	if R is Neighbour Finder or (R is next door and the rank of the player >= the entry-rank of R), decide yes;
	decide no.
School28 is an academic room. The printed name of School28 is "Science Lab". "A large metal lab bench has two metal bowls embedded into it. Maybe you can [bold type]craft[roman type] something in each.". The shape of School28 is L5/0-0-0-0-1-1. The grid position of School28 is <5,14,8>. School28 is east of School25. School28 is north of School15.
To decide which number is the entry-rank of (R - School28):
	decide on 3.

[Rooms Above Upper Hallway]
School29 is a lecture academic room. The printed name of School29 is "Ruby Classroom". "This 'classroom' has rows of desks but no chairs. The walls are adorned with photos of [if diaper quest is 1]sexy adult women in dry diapers[otherwise]voluptuous women pleasuring themselves[end if].". The shape of School29 is L5/0-0-0-0-1-0. The grid position of School29 is <5,11,9>. School29 is north of School26.
To decide which number is the entry-rank of (R - School29):
	decide on 3.
School30 is a lecture academic room. The printed name of School30 is "Pink Diamond Classroom". "This 'classroom' has a large circle of lit candles on the ground. The walls are adorned with photos of [if diaper quest is 1]sexy adult women using their diapers[otherwise]voluptuous women taking cocks in all their holes[end if].". The shape of School30 is L5/0-0-0-0-1-0. The grid position of School30 is <5,13,9>. School30 is north of School25.
To decide which number is the entry-rank of (R - School30):
	decide on 4.
School31 is an academic room. The printed name of School31 is "Trophy Hall". "A series of trophies, each for a different [if diaper quest is 1]baby related[otherwise]extremely lewd[end if] act, sit on shelves that line the east and west walls. To the north the door says 'Diamond Class'.". The shape of School31 is L5/0-0-1-0-1-0. The grid position of School31 is <5,12,9>. School31 is north of School24.
To decide which number is the entry-rank of (R - School31):
	decide on 4.
School32 is a lecture academic room. The printed name of School32 is "Diamond Classroom". "This room is fashioned like a [if diaper quest is 1]giant crib, covered in brightly coloured soft blankets and animal themed cushions, and populated by giant stuffed animals and baby toys[otherwise]porno studio, with cameras, spotlights and microphones on poles all trained in on a soft rug at the far end of the room[end if]. The only exit is behind you to the south, back into the Trophy Room.". The shape of School32 is L5/0-0-0-0-1-0. The grid position of School32 is <5,12,10>. School32 is north of School31.
To decide which number is the entry-rank of (R - School32):
	decide on 5.

[School33 to 35 are the dungeon]

[East Dungeon]
School33 is an academic room. The printed name of School33 is "Dungeon Hall". "Dungeon cells sit either side of this hidden extension to the hallway.". The shape of School33 is L5/0-0-1-0-1-1. The grid position of School33 is <5,16,6>. [School33 is east of School07.]
Report going when the player is in School33:
	change the east exit of School07 to School33; [As soon as the player steps into the hall from either cell we need to make the connection, otherwise the map button won't appear.]
	update Nviables of School07;
	update Nviables of School33.

School34 is an academic room. The printed name of School34 is "Dungeon Cell". "A dark cell. The cell has a permanently open doorway, but anyone cuffed to the chains attached to the wall would be unable to leave.". The shape of School34 is L5/0-0-1-0-0-0. The grid position of School34 is <5,16,5>. School34 is south of School33.
School35 is an academic room. The printed name of School35 is "Dungeon Cell". "A dark cell.". The shape of School35 is L5/0-0-0-0-1-0. The grid position of School35 is <5,16,7>. School35 is north of School33.

To decide which number is the entry-rank of (R - School33):
	decide on 6.
To decide which number is the entry-rank of (R - School34):
	decide on 6.
To decide which number is the entry-rank of (R - School35):
	decide on 6.

The School is a region. School01, School02, School03, School04, School05, School06, School07, School08, School09, School10, School11, School12, School13, School14, School15, School16, School17, School18, School19, School20, School21, School22, School23, School24, School25, School26, School27, School28, School29, School30, School31, School32, School33, School34, School35 are in The School.

To reveal the school dungeon:
	change the east exit of School07 to School33;
	update Nviables of School07;
	update Nviables of School33;
	now School33 is seen;
	now School33 is discovered;
	now School34 is seen;
	now School34 is discovered;
	now School35 is seen;
	now School35 is discovered.

Carry out going west when the location of the player is School33:
	reveal the school dungeon. [if we've exited via the secret doorway then we can return]

previous-dungeon-favour is a number that varies.
dungeon-favour is a number that varies.
dungeon-time is a number that varies.
dungeon-events is a number that varies.

An all time based rule (this is the dungeon sentence progress rule):
	if dungeon chains is worn:
		increase dungeon-time by time-seconds;
		if dungeon-time > 40 and the player is not immobile:
			now dungeon-time is 0;
			let M be a random alive undefeated teacher;
			if M is nothing, now M is a random alive undefeated staff member;
			compute dungeon checkup of M.

To compute (M - a monster) dungeon locking:
	reveal the school dungeon;
	now lessonJustDone is false;
	now dungeon-favour is 0;
	say DungeonLockPrepFlav of M;
	drag to School34 by M;
	compute dungeon chain binding of M;
	say DungeonLockAfterFlav of M;
	if there is held bottle or there is held TQedible thing, compute dungeon drink confiscating of M;
	if skeleton key is held:
		say "[speech style of M]'You're certainly not allowed this!'[roman type][line break][BigNameDesc of M] confiscates [NameDesc of skeleton key]!";
		now skeleton key is in School33;
	compute dungeon long term challenge of M;
	say DungeonLockLeaveFlav of M;
	try M going north;
	display entire map;
	repeat with N running through alive students:
		distract N;
	repeat with N running through alive staff members:
		distract N.

To compute dungeon chain binding of (M - a monster):
	say DungeonLockFlav of M;
	now dungeon chains is worn by the player;
	now dungeon chains is stuck;
	lock dungeon chains;
	say "You are locked into ankle chains.[if pair of handcuffs is actually summonable][BigNameDesc of M] also puts you in handcuffs![end if]";
	if pair of handcuffs is actually summonable, summon pair of handcuffs locked;
	now pair of handcuffs is wrist-bound-in-front;
	repeat with C running through things penetrating face:
		say "[M] removes your [ShortDesc of C], presumably to make sure that you are still able to drink.";
		now C is in Dungeon33.

To say DungeonLockPrepFlav of (M - a monster):
	say "[speech style of M]'This has only ever been necessary once before.'[roman type][line break][BigNameDesc of M] grabs your arm. ".

To say DungeonLockFlav of (M - a monster):
	say "[speech style of M]'Hold still.'[roman type][line break]".

To say DungeonLockAfterFlav of (M - a monster):
	say "[speech style of M]'You will be let out when we believe you have learned your lesson. I guess how long that takes is up to you.'[roman type][line break]".

To compute dungeon drink confiscating of (M - a monster):
	if there is a held bottle or there is a held TQedible thing, say DungeonDrinkFlav of M;
	repeat with B running through held TQedible things:
		now B is in School33;
	repeat with B running through held bottles:
		now B is in School33.

To say DungeonDrinkFlav of (M - a monster):
	say "[speech style of M]'You won't be needing these.'[roman type][line break][BigNameDesc of M] confiscates all of your [if there is held TQedible thing]food[end if][if there is held TQedible thing and there is held bottle] and [end if][if the number of held bottle >= 2]drinks[otherwise if there is held bottle]drink[end if]!".

To say DungeonLockLeaveFlav of (M - a monster):
	say "With that, [he of M] turns to leave you alone.".

To compute dungeon long term challenge of (M - a monster):
	if ex-princess is sex-enslaved and ex-princess is in School34:
		compute dungeon princess challenge of M;
	otherwise if ex-princess is diaper-enslaved and ex-princess is in School34:
		compute dungeon princess diaper challenge of M;
	otherwise if mythical creature fetish is 1 or tentacle fetish is 1 or inhuman pregnancy > 1:
		compute dungeon tentacle challenge of M;
	otherwise:
		compute pink smoke challenge of M;

To compute dungeon tentacle challenge of (M - a monster):[maybe once the tentacle monster is large enough it breaks you out of prison]
	let T be a random off-stage tentacle monster;
	if T is monster:
		now T is newborn;
		set up T;
		now T is in the location of the player;
		now the sleep of T is 7;
		say DungeonTentacleDeclarationFlav of M.

To say DungeonTentacleDeclarationFlav of (M - a monster):
	say "[speech style of M]'BRING IT IN!'[roman type][line break][BigNameDesc of M] calls behind [him of M] and two students carry a grey mass into the room between you. As they drop it next to you, you realise what it is - a sleeping tentacle monster![line break][speech style of M]'Each time this fucks you, it will grow larger. So if I were you I would want to get out of here as soon as possible.'[roman type][line break]".

To compute pink smoke challenge of (M - a monster):
	now School34 is smoky;
	if diaper lover > 0, compute dungeon diaper setup of M;
	say DungeonSmokeDeclarationFlav of M;
	update backdrop positions;
	compute dungeon wand donation of M.

To say DungeonSmokeDeclarationFlav of (M - a monster):
	say "[speech style of M]'Release the gas!'[roman type][line break][BigNameDesc of M] calls behind [him of M] and moments later pink smoke fills the bottom of your cell![line break][speech style of M]'I imagine you'll enjoy the feeling of resting down here, but try not to get too addicted, or maybe you'll never want to leave!'[roman type][line break]".

To compute dungeon wand donation of (M - a monster):
	if glittery-wand is off-stage:
		now glittery-wand is in the location of the player;
		say "[speech style of M]'Here, something to entertain yourself with if you get too horny.'[roman type][line break][BigNameDesc of M] throws a [glittery-wand] within your reach.[roman type][line break]".

To compute dungeon diaper setup of (M - a monster):
	let D be a random worn knickers;
	if D is not a clean diaper:
		say "With a few swift motions, [NameDesc of M] has [if D is a thing]removed your [D] and [end if]put you in a new fresh diaper.";
		if D is a thing, destroy D;
		let D be a random eligible diaper;
		summon D cursed with quest;
	otherwise if D is not cursed:
		say "With an arcane gesture, [NameDesc of M] lays a curse on your [D]!";
		fully curse D;
		compute summoned quest of D.

To compute dungeon checkup of (M - a monster):
	now M is in the location of the player;
	now previous-dungeon-favour is dungeon-favour;
	say DungeonCheckupArrivalFlav of M;
	compute dungeon test of M;
	increase dungeon-events by 1;
	check dungeon release of M;
	say DungeonCheckupDepartureFlav of M;
	try M going north;
	regionally place M.

To say DungeonCheckupArrivalFlav of (M - a monster):
	say "[M] [bold type]appears at your cell entrance![roman type][line break]".

To say DungeonCheckupDepartureFlav of (M - a monster):
	say "[M] turns to leave.[roman type][line break]".

To check dungeon release of (M - a monster):
	if dungeon-favour >= 3 or dungeon-events >= 5:
		say "[speech style of M]'I guess you have served your time.'[roman type][line break][BigNameDesc of M] releases you from the ankle chains!";
		now dungeon chains is in the location of the player;
		if bondage protection > 0:
			repeat with C running through worn locked clothing:
				let K be a random unlock-key covering C;
				unless K is a thing and K is not held by current-monster and bondage protection < 2:
					say "[big he of M] unlocks your [ShortDesc of C]!";
					unlock C;
		only summon armband;
		say "Your [ShortDesc of armband] reappears on your arm!";
		repeat with N running through fucked-silly staff members:
			now N is unleashed;
			if N is nurse, now N is in School11;
			if N is receptionist, now N is in School01;
		now School34 is not smoky;
		display entire map;
		if class-time < 0, now class-time is 0; [so we don't go straight into detention for being late]
	otherwise if dungeon-favour > previous-dungeon-favour and dungeon-events is not 3:
		say "[speech style of M]'Good. [if dungeon-favour >= 2]You're getting close to earning your release. Keep going[otherwise]Keep it up and we'll think about letting you go[end if].'[roman type][line break]";
	otherwise:
		say "[speech style of M]'[if dungeon-events is 3]You would be out by now if you had complied, by the way[otherwise if dungeon-events > 3]You continue to test our tolerance. Hmm[otherwise]At this rate, you're going to be in here longer than necessary[end if].'[roman type][line break]";

A dungeon-test is a kind of object.
dungeon-test-monster is an object that varies.
Definition: a dungeon-test is eligible: decide yes.

To compute dungeon test of (M - a monster):
	now dungeon-test-monster is M;
	execute a random eligible dungeon-test.

dungeon-food-test is a dungeon-test.
Definition: dungeon-food-test is eligible:
	if the player is not overly full and face is not actually occupied, decide yes;
	decide no.
To execute (T - dungeon-food-test):
	let M be dungeon-test-monster;
	say "[speech style of M]'Here's your food, little slave.'[roman type][line break][BigNameDesc of M] drops a dog bowl in front of you! It's filled with mushy peas[if watersports fetish is 1] drowned in [urine][otherwise if diaper quest is 0] drowned in [semen][end if]. Do you [if the player is upright]get down on your knees and [end if]eat it? ";
	if the player is bimbo consenting:
		StomachFoodUp 1;
		say "You [if the player is upright]kneel and [end if]begin to eat the degrading meal without the use of your hands. You feel thoroughly humiliated as [NameDesc of M] watches you with a mocking sneer. [strongHumiliateReflect]When you are finished [he of M] takes the bowl away.";
		if watersports fetish is 1:
			StomachUrineUp 1;
		otherwise if diaper quest is 0:
			StomachSemenUp 1;
		otherwise if diaper messing >= 4:
			say "Moments later, you feel your stomach growl angrily. Uh-oh...";
			increase suppository by 1;
		otherwise:
			SlowDelicateUp 1;
		now the stance of the player is 1;
		increase dungeon-favour by 1;
	otherwise:
		say "When [he of M] sees that you're not going to eat, [he of M] harrumphs.[line break][speech style of M]'Fine, have it your way. You're not going to earn your release that way, though.'[roman type][line break]".

dungeon-degradation-test is a dungeon-test.
To execute (T - dungeon-degradation-test):
	let M be dungeon-test-monster;
	say "[speech style of M]'What are you?'[roman type][line break]It looks like [he of M] wants you to admit your inferiority. What can you bring yourself to say[one of]? The more extreme your statement, the more chance you have of satisfying [him of M], but the more damaging it will be to your self-esteem.[or]?[stopping]";
	reset multiple choice questions;
	set numerical response 1 to the substituted form of "A [one of]pervert[or][if diaper quest is 1]diaper slave[otherwise]whore[end if][or]bitch[at random]";
	set numerical response 2 to the substituted form of "[if diaper quest is 1]A [one of]helpless[or]dumb[or]big[at random] baby[otherwise]A [one of]shameless nympho[or]brainless bimbo[or]cock-hungry slut[at random]";
	set numerical response 3 to the substituted form of "Your [one of]loyal[or]obedient[or]dedicated[cycling] [if diaper quest is 1][one of]padded[or]diaper dependent[in random order] [otherwise][end if][if watersports fetish is 1 and diaper quest is 1][one of]toilet[or]urinal[or]baby slave[in random order][otherwise if watersports fetish is 1][one of]toilet[or]urinal[or]slave[in random order][otherwise if diaper quest is 0][one of]cumdumpster[or]slave[or]servant[in random order][otherwise if diaper quest is 1]baby slave[otherwise]slave[end if]";
	set numerical response 4 to the substituted form of "A [one of]disgusting[or]disgraceful[or]pathetic[at random], [one of]worthless[or]useless[or]good-for-nothing[at random] [if diaper quest is 1 and diaper messing >= 3][one of]pottypants[or]panty pooper[or]stinker[at random][otherwise if diaper quest is 1][one of]pottypants[or]bedwetter[or]peepot[at random][otherwise if the player is possessing a vagina][one of]set of fuckholes[or]cocksleeve[or]cuntwarmer[at random][otherwise][one of]fuckdoll[or]worm[or]cunt[at random][end if]";
	set numerical response 0 to "refuse to answer";
	compute multiple choice question;
	let R be a random number between 1 and 6;
	if player-numerical-response > 0:
		say "[variable custom style]'[chosen numerical response].'[roman type][line break]You [blush 300 * player-numerical-response] as you speak.";
		increase player-numerical-response by 3;
		if debuginfo > 0, say "[input-style]Successful self-degradation check: Degradation rating ([player-numerical-response]) | [R].5 = (d6) [ShortDesc of M] mood[roman type][line break]";
	if player-numerical-response > R:
		say "[BigNameDesc of M] seems satisfied.";
		increase dungeon-favour by 1;
	otherwise:
		say "[big he of M] [if player-numerical-response is 0]frowns at your silence[otherwise]tilts [his of M] head to the side, looking underwhelmed[end if].[line break][speech style of M]'Disappointing. [if player-numerical-response is 0]Clearly your stay hasn't been long enough yet[otherwise]Perhaps you need to stay in here a bit longer[end if].'[roman type][line break]".

dungeon-oral-test is a dungeon-test.
Definition: dungeon-oral-test is eligible:
	if diaper quest is 0 and face is not actually occupied, decide yes;
	decide no.
To execute (T - dungeon-oral-test):
	let M be dungeon-test-monster;
	if M is male:
		say "[big he of M] positions [his of M] [manly-penis] in front of your mouth.[line break][speech style of M]'Suck it.'[roman type][line break]Do you perform fellatio on [him of M]? ";
	otherwise if a2m fetish > 0:
		say "[big he of M] bends over, pushing [his of M] ass into your face and more importantly [his of M] asshole over your mouth.[line break][speech style of M]'Lick it.'[roman type][line break]Do you perform anilingus on [him of M]? ";
	otherwise:
		say "[big he of M] bends over, pushing [his of M] ass into your face and more importantly [his of M] pussy over your mouth.[line break][speech style of M]'Lick it.'[roman type][line break]Do you perform cunnilingus on [him of M]? ";
	if the player is bimbo consenting:
		say "You [if M is male]accept [his of M] rod into your mouth and begin to work[otherwise]push your tongue into [his of M] sweaty hole and begin to lick[end if] away. [big he of M] seems happy to let you do all of the work, holding [himself of M] completely still. [if a2m fetish > 0]Even though it's not dirty, your tongue is still able to detect that unmistakable taste of ass[otherwise]Your tongue is overwhelmed by the strong tangy taste of sweaty pussy[end if][if M is male] - [he of M] must have recently been ruining some poor other student's holes[end if]. [if a2m fetish > 0][TasteGrossOut 7][otherwise][TasteGrossOut 4][end if]After what can't have been much more than ten seconds [BigNameDesc of M] seems satisfied. It doesn't look like [he of M] intends you to bring [him of M] to orgasm right now, and [he of M] withdraws. [severeHumiliateReflect][if the oral sex addiction of the player > 4]You are so used to bringing your partners to completion that this leaves you feeling somewhat uncomfortable![otherwise]You're just glad it was all over so quickly.[end if]";
		OralSexAddictUp 1;
		increase dungeon-favour by 1;
	otherwise:
		say "[big he of M] growls at your lack of compliance.[line break][speech style of M]'You'd really rather stay here even longer? Fine by me.'[roman type][line break]".

dungeon-bottle-test is a dungeon-test.
Definition: dungeon-bottle-test is eligible:
	if diaper quest is 1 and face is not actually occupied and the player is not overly full, decide yes;
	decide no.
To execute (T - dungeon-bottle-test):
	let M be dungeon-test-monster;
	say "[big he of M] holds a baby's bottle full of [milk] in front of you face, trying to coax the nipple into your mouth.[line break][speech style of M]'Time for your drinkies, baby!'[roman type][line break]Do you drink from the bottle? ";
	if the player is bimbo consenting:
		say "You accept the nipple into your mouth and begin to suck. With the [NameDesc of M] holding the bottle, it really feels like you're a big baby. [moderateHumiliateReflect]";
		SlowDelicateUp 1;
		StomachMilkUp 2;
		increase dungeon-favour by 1;
	otherwise:
		say "[big he of M] growls at your refusal.[line break][speech style of M]'You'd really rather stay here even longer? Fine by me.'[roman type][line break]".

[dungeon-breakout-test is a dungeon-test.
Definition: dungeon-breakout-test (called T) is eligible:
	let M be a random tentacle monster in the location of the player;
	if M is monster and M is massive:
		if dungeon-events > 4, decide yes;
	decide no.
To execute (T - dungeon-breakout-test):
	let M be dungeon-test-monster;
	let X be a random tentacle monster in the location of the player;
	say "The [X] busts you out of jail!";]

To compute dungeon princess challenge of (M - a monster):
	say DungeonPrincessDeclarationFlav of M.

To say DungeonPrincessDeclarationFlav of (M - a monster):
	say "You watch with [horror the bimbo of the player] as [NameDesc of ex-princess][']s buttcheeks begin to expand in size. [big his of ex-princess] hands clasp [his of ex-princess] butt, trying desperately to stop the growth, but to no avail. [BigNameDesc of M] laughs maliciously.[line break][speech style of M]'[if M is headmistress]I have[otherwise]The [ShortDesc of headmistress][end if] has decided that leaving you with agency is too dangerous. From now on you will be our live-in huge-assed cum-bucket. Thanks for putting your hands there of your own volition, by the way.'[line break][roman type][BigNameDesc of ex-princess] squeals as [he of ex-princess] tries to remove [his of ex-princess] hands and finds they are stuck in place on [his of M] now massive bottom.[line break][speech style of ex-princess]'Help! I can't move my hands! Nooo, mercy! I won't try to escape again! Just return me to my cell and give me my hands back and I'll be a good slave for you, I promise!'[line break][roman type][BigNameDesc of M] chuckles.[line break][speech style of M]'Sorry, [if M is headmistress]but if you didn't want me to be this cruel, perhaps you shouldn't have created me this way[otherwise]that's out of my... [']hands['][end if].'[roman type][line break]You watch as, completely outside of [his of ex-princess] own control, [NameDesc of ex-princess] lies on [his of ex-princess] back, and [his of ex-princess] legs raise themselves above [his of ex-princess] body before locking themselves behind [his of ex-princess] shoulders, in a sort-of pretzel position.[line break][speech style of ex-princess]'Noooooo!'[roman type][line break][BigNameDesc of M] rubs [NameDesc of ex-princess][']s belly lovingly.";
	say "[speech style of M]'We've applied a special curse to your belly. At least once every minute, your butthole will fill up with a bit of warm sticky semen. The curse will never be lifted until this pocket dimension of yours is somehow destroyed. It will always happen, at least once a minute, and usually faster. While you're awake. While you're asleep. When you're alone. When you're in front of people. You'll be lying on your back, feet behind your head, holding your oversized butt cheeks apart, farting cum. Forever.'[roman type][line break][big he of M] pauses for a moment to let that sink in, and then turns to you.[line break][speech style of M]'As for your punishment for this jailbreak attempt, [NameBimbo]... well, we're going to leave you with [if ex-princess is male]Andy[otherwise]Annie[end if] Asscum for a while. Oh, and the floor of this room has been enchanted with a clever spell, where if it detects any cum, it'll collect it into a condom and pin that to your clothing. So you'll need to decide whether you would rather drink the semen from [his of ex-princess] butthole, or wear it with pride from now on. I'll see you in a while!'";

To compute dungeon princess diaper challenge of (M - a monster):
	compute dungeon diaper setup of M;
	now the current-torment of ex-princess is a random number between 25 and 35;
	say DungeonPrincessDiaperDeclarationFlav of M.

To say DungeonPrincessDiaperDeclarationFlav of (M - a monster):
	say "With a snap of [NameDesc of M][']s fingers, [NameDesc of ex-princess] is now wearing a massive white diaper with a colourful alien pattern, and a sheer pink nightie. Thick deep pink baby mittens and booties complete [his of ex-princess] new outfit. You watch with [horror the bimbo of the player] as [NameDesc of M] then presses [his of M] hands to [NameDesc of ex-princess][']s scalp, and [NameDesc of ex-princess][']s eyes roll into the back of [his of ex-princess] head.[line break][speech style of ex-princess]'What? No... please, don't make me do that... no, anything but that...!'[roman type][line break][BigNameDesc of M] laughs maliciously, as the front of [NameDesc of ex-princess][']s diaper visibly yellows, and [he of ex-princess] flushes red with what you assume is shame. But it quickly becomes clear that it's not just embarrassment - [his of ex-princess] tongue lolls out of [his of ex-princess] mouth and [he of ex-princess] involuntarily moves one mittened hand to the front of [his of ex-princess] diaper and the other to [his of ex-princess] right breast. Both start rubbing fervently, as [he of ex-princess] emits a loud erotic cry.[line break][speech style of M]'Let me explain to [NameBimbo] what just happened. [if M is headmistress]I have[otherwise]The [ShortDesc of headmistress][end if] has decided that the princess just being a diaper pail was too kind. The bitch is now [one of]fully[or]hopelessly[or]utterly[or]totally[or]completely[at random] incontinent, and from now on, whenever [he of ex-princess] soils [himself of ex-princess], [he of ex-princess] will be overcome with an incredibly powerful state of arousal.'[roman type][line break]";
	say "[BigNameDesc of M] pauses to chuckle.[line break][speech style of M]'That's not all. Whenever [he of ex-princess] sees someone in a used diaper, [he of ex-princess] will be completely unable to stop [himself of ex-princess] from smushing [his of ex-princess] face into it, until the wearer walks away. Of course... you can't walk away right now, can you?'[line break][roman type][BigNameDesc of M] turns to fully face you, and then presses [his of M] hands to your belly. For a moment, a low humming sound can be heard.[line break][speech style of M]'As for your punishment for this jailbreak attempt, [NameBimbo]... well, we're going to leave you with Fannie Facerub for a while. Oh, and your belly has been enchanted with a cheeky little spell, to make your [if diaper messing < 4]bladder[otherwise]bowels[end if] go into overdrive for a little while. So, enjoy trying to hold on until I return.'".

An all time based rule (this is the school dungeon diaper balance rule):
	if diaper quest is 1 and the player is in School34 and ex-princess is in the location of the player:
		if the stomach-food of the player < 2, now the stomach-food of the player is 2;
		if the stomach-liquid of the player < 5, now the stomach-water of the player is 5.

Part - Junk Room Stuff

School15 has a number called donations.
Check taking clothing when the player is in School15:
	if the noun is not held and the donations of School15 < 5 and headmistress is alive and headmistress is undefeated, say "The magic in the room somehow keeps the [ShortDesc of the noun] stuck to the ground! Maybe the magic will weaken if you leave a few of your own possessions here?" instead.

Carry out taking clothing when the player is in School15:
	if headmistress is alive and headmistress is undefeated:
		decrease the donations of School15 by 5;
		say "The magic runes around the ceiling and doorway [if the donations of School15 < 5]come back to life, glowing their powerful purple once again[otherwise]quickly pulse five times before returning to being inactive[end if].".

Report dropping clothing when the noun is in School15:
	if the noun is cursed:
		say "The magic runes around the ceiling and doorway turn black for a moment before [if the donations of School15 < 5]returning to their previous purple pulse[otherwise]returning to being grey and inactive[end if]. Maybe [if the noun is sure]because [end if]the [ShortDesc of the noun] was cursed?";
		now the noun is sure;
	otherwise if the noun is plentiful accessory:
		say "The magic runes around the ceiling and doorway seem to fail to detect that you've dropped [NameDesc of the noun].";
	otherwise:
		increase the donations of School15 by 1;
		say "The magic runes around the ceiling and doorway pulse and vibrate brilliantly [if the donations of School15 is 1]once[otherwise][donations of School15] times[end if] before [if the donations of School15 < 5]returning to their previous slower rhythm[otherwise if the donations of School15 is 5]becoming grey and inactive[otherwise]returning to being grey and inactive[end if].".

School ends here.
