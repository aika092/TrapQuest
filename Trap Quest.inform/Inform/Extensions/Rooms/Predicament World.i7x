Predicament World by Rooms begins here.


A predicament room is a kind of room. A park room is a kind of predicament room.
The shape of a predicament room is usually L8/0-0-0-0-0-0. The grid position of a predicament room is usually <8,0,0>.
Definition: a predicament room is unwalled: decide yes.
To decide which number is the concealment of (R - a predicament room):
	decide on 3.


Definition: a predicament room (called R) is within vision:
	if R is the location of the player, decide yes;
	if the player is not in Toilet01 and the player is not in Toilet02 and the player is not in Predicament01 and the player is not in Predicament02, decide yes;
	decide no.

A predicament room is a kind of room. A predicament room has a labyrinth shape called shape. The shape of a predicament room is usually L8/0-0-1-1-1-1. The grid position of a predicament room is usually <0,0,0>.
A predicament room is usually pinned.[These rooms are always in the same place.]
To decide which number is the concealment of (R - a predicament room):
	decide on -1.

Predicament01 is a predicament room. Predicament01 is discovered. The printed name of Predicament01 is "Abandoned Warehouse". The shape of Predicament01 is L8/0-0-1-0-0-0. The grid position of Predicament01 is <8,12,5>. Predicament01 is bossed.
Definition: Predicament01 is unwalled: decide no.
Predicament02 is a predicament room. The printed name of Predicament02 is "Alleyway". "Around the corner of this small alleyway you can hear the sounds of a road. Cars are irregular but rather frequent.". The shape of Predicament02 is L8/0-0-0-1-1-0. The grid position of Predicament02 is <8,12,6>. Predicament02 is north of Predicament01. Predicament02 is bossed.

[Ring Road]

Predicament03 is a predicament room. The printed name of Predicament03 is "Main Road". The grid position of Predicament03 is <8,13,6>. Predicament03 is east of Predicament02.
Predicament04 is a predicament room. The printed name of Predicament04 is "Main Road". The shape of Predicament04 is L8/0-0-0-1-1-1. The grid position of Predicament04 is <8,13,7>. Predicament04 is north of Predicament03.
Predicament05 is a predicament room. The printed name of Predicament05 is "Main Road". The shape of Predicament05 is L8/0-0-0-0-1-1. The grid position of Predicament05 is <8,13,8>. Predicament05 is north of Predicament04.
Predicament06 is a predicament room. The printed name of Predicament06 is "Main Road". The shape of Predicament06 is L8/0-0-0-1-1-1. The grid position of Predicament06 is <8,14,8>. Predicament06 is east of Predicament05.
Predicament07 is a predicament room. The printed name of Predicament07 is "Main Road". The shape of Predicament07 is L8/0-0-0-1-1-1. The grid position of Predicament07 is <8,15,8>. Predicament07 is east of Predicament06.
Predicament08 is a predicament room. The printed name of Predicament08 is "Main Road". The shape of Predicament08 is L8/0-0-0-1-1-1. The grid position of Predicament08 is <8,16,8>. Predicament08 is east of Predicament07.
Predicament09 is a predicament room. The printed name of Predicament09 is "Main Road". The shape of Predicament09 is L8/0-0-0-0-1-1. The grid position of Predicament09 is <8,17,8>. Predicament09 is east of Predicament08.
Predicament10 is a predicament room. The printed name of Predicament10 is "Main Road". The shape of Predicament10 is L8/0-0-1-0-1-1. The grid position of Predicament10 is <8,17,7>. Predicament10 is south of Predicament09.
Predicament11 is a predicament room. The printed name of Predicament11 is "Main Road". The grid position of Predicament11 is <8,17,6>. Predicament11 is south of Predicament10.
Predicament12 is a predicament room. The printed name of Predicament12 is "Main Road". The shape of Predicament12 is L8/0-0-1-0-1-1. The grid position of Predicament12 is <8,17,5>. Predicament12 is south of Predicament11.
Predicament13 is a predicament room. The printed name of Predicament13 is "Main Road". The shape of Predicament13 is L8/0-0-1-0-1-1. The grid position of Predicament13 is <8,17,4>. Predicament13 is south of Predicament12.
Predicament14 is a predicament room. The printed name of Predicament14 is "Main Road". The shape of Predicament14 is L8/0-0-1-0-0-1. The grid position of Predicament14 is <8,16,4>. Predicament14 is west of Predicament13.
Predicament15 is a predicament room. The printed name of Predicament15 is "Main Road". The shape of Predicament15 is L8/0-0-1-1-0-1. The grid position of Predicament15 is <8,15,4>. Predicament15 is west of Predicament14.
Predicament16 is a predicament room. The printed name of Predicament16 is "Main Road". The shape of Predicament16 is L8/0-0-1-1-0-1. The grid position of Predicament16 is <8,14,4>. Predicament16 is west of Predicament15.
Predicament17 is a predicament room. The printed name of Predicament17 is "Main Road". The shape of Predicament17 is L8/0-0-1-1-0-0. The grid position of Predicament17 is <8,13,4>. Predicament17 is west of Predicament16.
Predicament18 is a predicament room. The printed name of Predicament18 is "Main Road". The shape of Predicament18 is L8/0-0-1-1-1-0. The grid position of Predicament18 is <8,13,5>. Predicament18 is north of Predicament17. Predicament18 is south of Predicament03.

[Home]

Predicament19 is a predicament room. The printed name of Predicament19 is "Driveway". "The entrance to your house is right in front of you. Thank goodness!". The shape of Predicament19 is L8/0-0-0-1-0-1. The grid position of Predicament19 is <8,18,6>. Predicament19 is east of Predicament11. Predicament19 is bossed.
Predicament20 is a predicament room. The printed name of Predicament20 is "Portal Room". "Instead of your house, there's just a room with a portal...". The shape of Predicament20 is L8/0-0-0-1-0-1. The grid position of Predicament20 is <8,19,6>. Predicament20 is east of Predicament19. Predicament20 is bossed.
Definition: Predicament20 is unwalled: decide no.
Check going north when the player is in Predicament20:
	[let Y be 0;
	repeat with C running through portable things in the location of the player:
		if C is not held and C is not person, now Y is 1;
	if Y is 1:
		say "[bold type]You have left stuff on the ground here. [roman type]Are you sure you want to do that? You might not be able to get it back any time soon.";
		unless the player is consenting, say "Action cancelled." instead;]
	let T be a random trophy in the location of the player;
	if T is nothing, now T is a random held trophy;
	if T is trophy and the trophy-mode of T is 0:
		say "You have a new trophy to consider activating here. Are you sure you want to leave without activating it? ";
		unless the player is consenting, say "Action cancelled." instead.

Report going north when the player is in School01:
	now map-zoom is saved-map-zoom;
	clean up predicament universe;
	repeat with T running through on-stage trophies:
		if T is held, say "[bold type][BigNameDesc of T] [bold type]is ripped from your hands by an invisible force, and in your mind's eye you can see that it has been taken to the 'Trophy Hall'![roman type][line break]";
		now T is in School31;
	repeat with R running through predicament rooms:
		repeat with T running through things in R:
			if T is not person and T is portable, now T is in School01;
	if the stomach-liquid of the player < 3, now the stomach-water of the player is 3 - the stomach-liquid of the player;
	if the player is hungry, now the stomach-food of the player is 2;
	progress quest of predicament-quest.


[Central Park]

To decide which number is the concealment of (R - a park room):
	decide on 0.

Park01 is a park room. The printed name of Park01 is "Park". "This area is just open grass. There is nothing to hide behind.". The grid position of Park01 is <8,14,7>. Park01 is east of Predicament04. Park01 is south of Predicament06.
To decide which number is the concealment of (R - Park01):
	decide on -1.
Park02 is a park room. The printed name of Park02 is "Public Toilets". "A small hut houses both male and female toilets. You can go [bold type]down[roman type] to go to the men's toilets or [bold type]up[roman type] to go to the women's toilets. The hut makes it eaiser to not be spotted here.". The grid position of Park02 is <8,15,7>. Park02 is east of Park01. Park02 is south of Predicament07.
To decide which number is the concealment of (R - Park02):
	decide on 5.
Park03 is a park room. The printed name of Park03 is "Upper Lake". "This section of the park is dominated by the lake, which makes it difficult to find anything to hid behind.". The grid position of Park03 is <8,16,7>. Park03 is east of Park02. Park03 is south of Predicament08. Park03 is west of Predicament10.
To decide which number is the obstacle-hindrance of (R - Park03):
	decide on 4.
To decide which text is ObstacledDesc of (R - Park03):
	decide on "It takes a bit of extra time to move around the outside of the lake.".
Park04 is a park room. The printed name of Park04 is "Trees". "There are a few trees here for you to hide behind.". The grid position of Park04 is <8,14,6>. Park04 is east of Predicament03. Park04 is south of Park01.
To decide which number is the concealment of (R - Park04):
	decide on 2.
Park05 is a park room. The printed name of Park05 is "Picnic Spot". "There are a lot of picnic benches here, and absolutely nothing to hide behind.". The grid position of Park05 is <8,15,6>. Park05 is east of Park04. Park05 is south of Park02.
To decide which number is the concealment of (R - Park05):
	decide on -1.
Park06 is a park room. The printed name of Park06 is "Park". "This area is just open grass. There is nothing to hide behind.". The grid position of Park06 is <8,16,6>. Park06 is east of Park05. Park06 is south of Park03. Park06 is west of Predicament11.
To decide which number is the concealment of (R - Park06):
	decide on -1.
Park07 is a park room. The printed name of Park07 is "Trees". "There are a few trees here for you to hide behind.". The grid position of Park07 is <8,14,5>. Park07 is east of Predicament18. Park07 is south of Park04. Park07 is north of Predicament16.
To decide which number is the concealment of (R - Park07):
	decide on 2.
Park08 is a park room. The printed name of Park08 is "Statue". "There's a large statue of an angel here. You can hide behind it pretty well.". The grid position of Park08 is <8,15,5>. Park08 is east of Park07. Park08 is south of Park05. Park08 is north of Predicament15.
To decide which number is the concealment of (R - Park08):
	decide on 4.
Park09 is a park room. The printed name of Park09 is "Tree". "There is a single tree here for you to hide behind.". The grid position of Park09 is <8,16,5>. Park09 is east of Park08. Park09 is south of Park06. Park09 is west of Predicament12. Park09 is north of Predicament14.
To decide which number is the concealment of (R - Park09):
	decide on 1.

Toilet01 is a bossed predicament room. Toilet01 is urinals. The printed name of Toilet01 is "Men's Toilets". Toilet01 is below Park02. The grid position of Toilet01 is <8,15,7>.
Definition: Toilet01 is nonstandard: decide yes.
Toilet02 is a bossed predicament room. Toilet02 is toilets. The printed name of Toilet02 is "Women's Toilets".  Toilet02 is above Park02. The grid position of Toilet02 is <8,15,7>.
Definition: Toilet02 is nonstandard: decide yes.


Predicament01, Predicament02, Predicament03, Predicament04, Predicament05, Predicament06, Predicament07, Predicament08, Predicament09, Predicament10, Predicament11, Predicament12, Predicament13, Predicament14, Predicament15, Predicament16, Predicament17, Predicament18, Predicament19, Predicament20, Park01, Park02, Park03, Park04, Park05, Park06, Park07, Park08, Park09, Toilet01, Toilet02 are in the School.

saved-map-zoom is a number that varies.

To clean up predicament universe:
	now Predicament11 is not discovered; [This is how we flag that the predicament world needs resetting the next time the player exits the alleyway]
	repeat with R running through unbossed predicament rooms:
		now R is not discovered;
	if smoothie van is in a predicament room, destroy smoothie van;
	repeat with E running through eggs:
		if E is in a predicament room, destroy E.

To set up predicament universe:
	set up bystanders for current-predicament.

Report going east when the player is in Predicament03:
	set up predicament universe;
	compute predicament map reveal.

To compute predicament map reveal:
	if Predicament11 is not discovered: [This means that the map has been darkened so yes we need to brighten it again]
		if Predicament19 is not discovered, say "[variable custom style]Wait a minute, I recognise this place, it's my old neighbourhood![roman type][line break]You realise that your old house is just on the other side of this park. Can you make it all the way to the east without being noticed?!"; [Since this room is bossed it won't be re-darkened usually. So we know that if it is darkened, this is the first time it's been revealed]
		now saved-map-zoom is map-zoom;
		now map-zoom is 3;
		repeat with R running through predicament rooms:
			unless R is Predicament20, now R is discovered;
		[display entire map.]

Report going when the player is in a bathroom predicament room:
	now map-zoom is 1.

Report going when the player is in Park02:
	now map-zoom is 3.







To say speech style of (M - a person):
	say first custom style.

A bystander is a kind of person. A bystander can be uninterested or interested. A bystander can be moved. The printed name of a bystander is "[TQlink of item described]bystander[TQxlink of item described][shortcut-desc][verb-desc of item described]".
[What's the most lewd they've seen the player this time?]
A bystander has a number called worst-appearance.
[Can be used for different things by different predicaments:
Smoothie predicament: How much will they enjoy the drink? (negative number means they have already tried a drink)]
A bystander has a number called bystanderInt1.
[Can be used for different things by different predicaments:
Smoothie predicament: How much convincing do they need?]
A bystander has a number called bystanderInt2.

To decide which number is the default park pull resistance of (M - a bystander):
	decide on a random number between 1 and 10. [90% of the time they ignore their drive to go to the centre]

To decide which number is the park pull resistance of (M - a bystander):
	decide on the default park pull resistance of M.

Definition: a bystander is strolling if a random number between 1 and 5 > 3.

[Which place do all bystanders tend to wander towards?]
To decide which room is the predicament-pull-room of (M - a bystander):
	if current-predicament is smoothie-predicament and the player is in Predicament03 and the bystanderInt1 of M >= 0, decide on Predicament03;
	decide on Park05.

bystander-room-target is a room that varies.

To compute movement of (M - a bystander):
	now M is moved;
	now neighbour finder is the location of M;
	let A be the best route from the location of M to the predicament-pull-room of M; [People love going to the centre]
	let R be the park pull resistance of M;
	if M is strolling or R <= 1:
		if A is not a direction or R > 1:
			now R is 3; [We use this to flag that the NPC is no longer choosing to walk towards the central park]
			let LA be the list of N-viable directions; [This is how we randomise an APPROPRIATE direction for M to walk in]
			sort LA in random order;
			if debugmode > 1, say "List of N-viable directions: [LA].";
			repeat with D running through LA:
				now bystander-room-target is the room D from neighbour finder;
				if debugmode > 1, say "Considering [D] ([bystander-room-target]): ";
				if M is target-room-happy:
					now A is D;
					if debugmode > 1, say "Chosen!";
					break;
				otherwise:
					if debugmode > 1, say "Not allowed.";
		if A is a direction:
			let P be the room A from (the location of M);
			if A is a direction and the number of barriers in P is 0 and the number of barriers in the location of M is 0:
				try M going A.

Definition: a bystander (called M) is target-room-happy:
	if bystander-room-target is bossed, decide no;
	decide yes. [Mostly yes but some NPCs will only go to the park or to the road]

To decide which number is the awareness of (M - a bystander):
	decide on 11.

To decide which number is the outrage tolerance of (M - a bystander):
	decide on 5.

To decide which number is the cringe tolerance of (M - a bystander):
	decide on 7.


To check perception of (M - a bystander):
	if M is reactive:
		if M is uninterested:
			let R be a random number between 1 and the awareness of M;
			let C be the concealment of the location of the player;
			let P be the stealth of the player;
			if debuginfo > 0, say "[input-style]Bystander perception check: awareness roll (d[awareness of M]) = [R] | [C + P].5 =  ([C].5) [location of the player] concealment rating + ([P]) player [if the player is upright]standing[otherwise]kneeling[end if] stealth rating[roman type][line break]";
			if C + P >= R:
				say "[BigNameDesc of M] fails to notice you.";
			otherwise:
				now M is interested;
				compute perception of M;
		otherwise if the worst-appearance of M < the appearance of the player or (diaper quest is 1 and the worst-appearance of M < the cringe appearance of the player):
			compute worsened perception of M;
		if M is interested:
			if the worst-appearance of M < the appearance of the player, now the worst-appearance of M is the appearance of the player;
			if diaper quest is 1 and the worst-appearance of M < the cringe appearance of the player, now the worst-appearance of M is the cringe appearance of the player;
	if the predicament-pull-room of M is Predicament03 and M is not in Predicament03, now M is uninterested. [People who didn't take a smoothie can reconsider if they step away then step back.]

To compute perception of (M - a bystander):
	say "[BigNameDesc of M] notices you! ";
	if smoothie gag is worn and the bystanderInt1 of M >= 0:
		compute smoothie perception of M;
	otherwise if diaper quest is 1 and the cringe appearance of the player > the cringe tolerance of M and (the cringe appearance of the player >= the appearance of the player or the appearance of the player <= the outrage tolerance of M):
		compute cringe perception reaction of M;
		say HumiliateReflect (the cringe appearance of the player * 30);
	otherwise if the appearance of the player > the outrage tolerance of M:
		compute lewd perception reaction of M;
		say HumiliateReflect (the appearance of the player * 30);
	otherwise:
		compute non-lewd perception reaction of M;
		say moderateHumiliateReflect;
	if skirt-tray-vibrator is worn and the cakes-taken of skirt-tray-vibrator < the max-cakes of skirt-tray-vibrator:
		compute cupcake perception of M. [This always happens even if they look lewd]

To compute worsened perception of (M - a bystander):
	if diaper quest is 1 and the cringe appearance of the player > the cringe tolerance of M and (the cringe appearance of the player >= the appearance of the player or the appearance of the player <= the outrage tolerance of M):
		say "[BigNameDesc of M] appears even more [one of]shocked by[or]disgusted at[or]unimpressed by[in random order] your appearance! ";
		compute cringe perception reaction of M;
		say HumiliateReflect (the cringe appearance of the player * 30);
	otherwise if the appearance of the player > the outrage tolerance of M:
		say "[BigNameDesc of M] appears even more [one of]shocked by[or]disgusted at[or]unimpressed by[in random order] your appearance! ";
		compute lewd perception reaction of M;
		say HumiliateReflect (the appearance of the player * 30);
	otherwise:
		compute non-lewd worsened perception reaction of M.

To compute lewd perception reaction of (M - a bystander):
	say "[line break][first custom style]'[one of]What the fuck?!'[or]Is [he of the player]...?!'[or]Holy shit! Are you insane?'[or]What the fuck?! Disgusting!'[or]Oh my god!'[or]In public?! How inappropriate!'[or]Why would you come outside like that?!'[or]Ugh! How indecent!'[in random order][roman type][line break]".

To compute cringe perception reaction of (M - a bystander):
	compute lewd perception reaction of M.

To compute non-lewd perception reaction of (M - a bystander):
	say "[big he of M] looks at you strangely but doesn't say anything.".

To compute non-lewd worsened perception reaction of (M - a bystander):
	say "[BigNameDesc of M] frowns at you.".






A camera-bystander is a kind of bystander. The printed name of a camera-bystander is "[TQlink of item described][man of item described] on [his of item described] phone[TQxlink of item described][shortcut-desc][verb-desc of item described]". Understand "man", "on his phone" as camera-bystander when item described is male. Understand "woman", "on her phone" as camera-bystander when item described is female. Understand "phone" as camera-bystander.

To compute lewd perception reaction of (M - a camera-bystander):
	say "[big he of M] [one of]widens [his of M] eyes and quickly[or]gasps and quickly[or]doesn't say anything, but just[then at random] raises [his of M] phone and snaps a photo of you![line break][italic type]CLICK![roman type][line break]You then see [him of M] tapping away, and a 'whoosh' sound as [he of M] sends the photo to who knows how many people![one of][line break][variable custom style]Noooo! How many people are going to have seen me like this?![roman type][line break][or][stopping]";
	let A be the appearance of the player;
	if diaper quest is 1 and the appearance of the player < the cringe appearance of the player, now A is the cringe appearance of the player;
	compute digital reputation damage (PredicamentActivity of current-predicament) strength (A) quality (a random number between 1 and 6).


To say FlashFlav of (M - a camera-bystander):
	say "[BigNameDesc of M] [if M is not interested]notices you! [big he of M] [end if]gasps, snapping several photos of you with [his of M] phone![line break][italic type]CLICK! CLICK! CLICK! CLICK![roman type][line break]And then... a 'whoosh' sound as [he of M] sends the photo to who knows how many people![one of][line break][variable custom style]Now the whole world will know my shame...[roman type][line break][or][stopping]";
	let T be PredicamentActivity of current-predicament;
	if target-poster is expulsion poster, now T is "expelling stuff from your [asshole]";
	if target-poster is masturbation poster, now T is "masturbating";
	if target-poster is wetting poster, now T is "[if the player is pee protected]wetting yourself[otherwise]urinating[end if]";
	let A be the appearance of the player;
	if diaper quest is 1 and the appearance of the player < the cringe appearance of the player, now A is the cringe appearance of the player;
	compute digital reputation damage T strength (A) quality (a random number between 1 and 4);
	now M is interested;
	if the worst-appearance of M < the appearance of the player, now the worst-appearance of M is the appearance of the player;
	if diaper quest is 1 and the worst-appearance of M < the cringe appearance of the player, now the worst-appearance of M is the cringe appearance of the player;
	say HumiliateReflect (the appearance of the player * 30).





Figure of Businessman Bystander is the file "NPCs/School/Bystander/bystander1.jpg".
Figure of Businesswoman Bystander is the file "NPCs/School/Bystander/bystander2.jpg".
Figure of Male Birdwatcher Bystander is the file "NPCs/School/Bystander/bystander3.jpg".
Figure of Female Birdwatcher Bystander is the file "NPCs/School/Bystander/bystander4.jpg".
Figure of Male Gardener Bystander is the file "NPCs/School/Bystander/bystander5.jpg".
Figure of Female Gardener Bystander is the file "NPCs/School/Bystander/bystander6.jpg".
Figure of Male Jogger Bystander is the file "NPCs/School/Bystander/bystander7.jpg".
Figure of Female Jogger Bystander is the file "NPCs/School/Bystander/bystander8.jpg".
Figure of Postman Bystander is the file "NPCs/School/Bystander/bystander9.jpg".
Figure of Postwoman Bystander is the file "NPCs/School/Bystander/bystander10.jpg".

Figure of Male Frisbeer Bystander is the file "NPCs/School/Bystander/bystander11.jpg".
Figure of Female Frisbeer Bystander is the file "NPCs/School/Bystander/bystander12.jpg".
Figure of Male Bookworm Bystander is the file "NPCs/School/Bystander/bystander13.jpg".
Figure of Female Bookworm Bystander is the file "NPCs/School/Bystander/bystander14.jpg".
Figure of Male Selfie Bystander is the file "NPCs/School/Bystander/bystander15.jpg".
Figure of Female Selfie Bystander is the file "NPCs/School/Bystander/bystander16.jpg".
Figure of Male Skater Bystander is the file "NPCs/School/Bystander/bystander17.jpg".
Figure of Female Skater Bystander is the file "NPCs/School/Bystander/bystander18.jpg".
Figure of Male Sunbather Bystander is the file "NPCs/School/Bystander/bystander19.jpg".
Figure of Female Sunbather Bystander is the file "NPCs/School/Bystander/bystander20.jpg".


Figure of Watchful Bystander is the file "NPCs/School/bystander6.jpg".
Figure of Dogwalking Bystander is the file "NPCs/School/bystander7.jpg".
Figure of Idle Bystander is the file "NPCs/School/bystander8.jpg".
[Figure of Football Bystander is the file "NPCs/School/bystander4.jpg".
Figure of Couple Bystander is the file "NPCs/School/bystander5.jpg".
Figure of Businesswoman Bystander is the file "NPCs/School/bystander9.jpg".
Figure of Engrossed Bystander is the file "NPCs/School/bystander10.jpg".
Figure of Jogging Bystander is the file "NPCs/School/bystander11.jpg".
Figure of Janitor Bystander is the file "NPCs/School/bystander12.jpg".
Figure of Rich Bystander is the file "NPCs/School/bystander13.jpg".
Figure of Policewoman Bystander is the file "NPCs/School/bystander14.jpg".]






To decide which figure-name is the examine-image of (M - a bystander):
	decide on figure of businessman bystander.

businessman-bystander is a bystander. The printed name of businessman-bystander is "[TQlink of item described]businessman[TQxlink of item described][shortcut-desc][verb-desc of item described]". Understand "businessman" as businessman-bystander.
To decide which number is the awareness of (M - businessman-bystander):
	decide on 4.
To decide which number is the cringe tolerance of (M - businessman-bystander):
	decide on 5.
To say ExamineDesc of (M - businessman-bystander):
	say "This smartly dressed man looks very busy and distracted. He is constantly checking his watch.".

businesswoman-bystander is a camera-bystander. businesswoman-bystander is female. The printed name of businesswoman-bystander is "[TQlink of item described]businesswoman[TQxlink of item described][shortcut-desc][verb-desc of item described]". Understand "businesswoman" as businesswoman-bystander.
To decide which figure-name is the examine-image of (M - businesswoman-bystander):
	decide on figure of businesswoman bystander.
To decide which number is the awareness of (M - businesswoman-bystander):
	decide on 6.
To decide which number is the outrage tolerance of (M - businesswoman-bystander):
	decide on 3.
To decide which number is the cringe tolerance of (M - businesswoman-bystander):
	decide on 3.
To say ExamineDesc of (M - businesswoman-bystander):
	say "This smartly dressed woman looks rather busy. She is in the middle of an important looking phonecall.".

male-birdwatcher-bystander is a camera-bystander. The printed name of male-birdwatcher-bystander is "[TQlink of item described]birdwatcher[TQxlink of item described][shortcut-desc][verb-desc of item described]". Understand "birdwatcher" as male-birdwatcher-bystander.
To decide which figure-name is the examine-image of (M - male-birdwatcher-bystander):
	decide on figure of male birdwatcher bystander.
To decide which number is the awareness of (M - male-birdwatcher-bystander):
	decide on 4.
To say ExamineDesc of (M - male-birdwatcher-bystander):
	say "This modestly dressed man is scouting around for interesting birds with his binoculars. A digital camera hangs from a strap around his neck, ready to be used at any time.".
Definition: male-birdwatcher-bystander is target-room-happy:
	if bystander-room-target is bossed or bystander-room-target is not park room, decide no;
	decide yes.

female-birdwatcher-bystander is a camera-bystander. female-birdwatcher-bystander is female. The printed name of female-birdwatcher-bystander is "[TQlink of item described]birdwatcher[TQxlink of item described][shortcut-desc][verb-desc of item described]". Understand "birdwatcher" as female-birdwatcher-bystander.
To decide which figure-name is the examine-image of (M - female-birdwatcher-bystander):
	decide on figure of female birdwatcher bystander.
To decide which number is the awareness of (M - female-birdwatcher-bystander):
	decide on 4.
To decide which number is the outrage tolerance of (M - female-birdwatcher-bystander):
	decide on 3.
To say ExamineDesc of (M - female-birdwatcher-bystander):
	say "This modestly dressed woman is scouting around for interesting birds with her binoculars. A digital camera hangs from a strap around her shoulder, ready to be used at any time.".
Definition: female-birdwatcher-bystander is target-room-happy:
	if bystander-room-target is bossed or bystander-room-target is not park room, decide no;
	decide yes.

male-gardener-bystander is a bystander. The printed name of male-gardener-bystander is "[TQlink of item described]gardener[TQxlink of item described][shortcut-desc][verb-desc of item described]". Understand "gardener" as male-gardener-bystander.
To decide which figure-name is the examine-image of (M - male-gardener-bystander):
	decide on figure of male gardener bystander.
To say ExamineDesc of (M - male-gardener-bystander):
	say "This man is wearing denim overalls and carrying a hoe. It looks like [he of M][']s currently on [his of M] break.".
To compute lewd perception reaction of (M - male-gardener-bystander):
	say "[line break][first custom style]'Oh my god! And I thought *this* was the biggest hoe in the area!'[roman type][line break]".
To compute cringe perception reaction of (M - male-gardener-bystander):
	say "[line break][first custom style]'Well now, that's just plain weird. Are you all right in the head?!'[roman type][line break]".
To set up smoothie stats of (M - male-gardener-bystander):
	now the bystanderInt1 of M is a random number between 3 and 9; [How much will they enjoy the drink?]
	now the bystanderInt2 of M is 0. [How much convincing do they need?]
Definition: male-gardener-bystander is target-room-happy:
	if bystander-room-target is bossed or bystander-room-target is not park room, decide no;
	decide yes.

female-gardener-bystander is a bystander. female-gardener-bystander is female. The printed name of female-gardener-bystander is "[TQlink of item described]gardener[TQxlink of item described][shortcut-desc][verb-desc of item described]". Understand "gardener" as female-gardener-bystander.
To decide which figure-name is the examine-image of (M - female-gardener-bystander):
	decide on figure of female gardener bystander.
To decide which number is the awareness of (M - female-gardener-bystander):
	decide on 7.
To say ExamineDesc of (M - female-gardener-bystander):
	say "This woman is wearing denim overalls and tending to the grass and flowers.".
To set up smoothie stats of (M - female-gardener-bystander):
	now the bystanderInt1 of M is a random number between 3 and 9; [How much will they enjoy the drink?]
	now the bystanderInt2 of M is 0. [How much convincing do they need?]
Definition: female-gardener-bystander is target-room-happy:
	if bystander-room-target is bossed or bystander-room-target is not park room, decide no;
	decide yes.

male-jogger-bystander is a bystander. The printed name of male-jogger-bystander is "[TQlink of item described]jogger[TQxlink of item described][shortcut-desc][verb-desc of item described]". Understand "jogger" as male-jogger-bystander.
To decide which figure-name is the examine-image of (M - male-jogger-bystander):
	decide on figure of male jogger bystander.
To say ExamineDesc of (M - male-jogger-bystander):
	say "This man is wearing a rather tight pair of exercise shorts and is completely topless, showing off his impressive abs. He's jogging at a decent pace, while listening to music through his earbuds.".
Definition: male-jogger-bystander is strolling: decide yes.
To decide which number is the outrage tolerance of (M - male-jogger-bystander):
	decide on 8.
To set up smoothie stats of (M - male-jogger-bystander):
	now the bystanderInt1 of M is a random number between 5 and 7; [How much will they enjoy the drink?]
	now the bystanderInt2 of M is a random number between -1 and 2. [How much convincing do they need?]

female-jogger-bystander is a bystander. female-jogger-bystander is female. The printed name of female-jogger-bystander is "[TQlink of item described]jogger[TQxlink of item described][shortcut-desc][verb-desc of item described]". Understand "jogger" as female-jogger-bystander.
To decide which figure-name is the examine-image of (M - female-jogger-bystander):
	decide on figure of female jogger bystander.
To say ExamineDesc of (M - female-jogger-bystander):
	say "This woman is wearing a rather skimpy set of exercise top and shorts. She's jogging at a decent pace, while listening to music through her earbuds.".
Definition: female-jogger-bystander is strolling: decide yes.
To decide which number is the outrage tolerance of (M - female-jogger-bystander):
	decide on 7.
To set up smoothie stats of (M - female-jogger-bystander):
	now the bystanderInt1 of M is a random number between 5 and 7; [How much will they enjoy the drink?]
	now the bystanderInt2 of M is a random number between -1 and 2. [How much convincing do they need?]

postman-bystander is a bystander. The printed name of postman-bystander is "[TQlink of item described]postman[TQxlink of item described][shortcut-desc][verb-desc of item described]". Understand "postman" as postman-bystander.
To decide which figure-name is the examine-image of (M - postman-bystander):
	decide on figure of postman bystander.
To say ExamineDesc of (M - postman-bystander):
	say "This man is wearing a postie's uniform and has a satchel full of mail slung over one shoulder. He's busy heading from postbox to postbox. He has a slightly mischievous grin on his face.".
Definition: postman-bystander is strolling: decide yes.
To decide which number is the outrage tolerance of (M - postman-bystander):
	decide on 9.
Definition: postman-bystander is target-room-happy:
	if bystander-room-target is bossed or bystander-room-target is park room, decide no;
	decide yes.

postwoman-bystander is a bystander. postwoman-bystander is female. The printed name of postwoman-bystander is "[TQlink of item described]postwoman[TQxlink of item described][shortcut-desc][verb-desc of item described]". Understand "postwoman" as postwoman-bystander.
To decide which figure-name is the examine-image of (M - postwoman-bystander):
	decide on figure of postwoman bystander.
To say ExamineDesc of (M - postwoman-bystander):
	say "This woman is wearing a postie's uniform and has a satchel full of mail slung over one shoulder. She's busy heading from postbox to postbox.".
Definition: postwoman-bystander is strolling: decide yes.
Definition: postwoman-bystander is target-room-happy:
	if bystander-room-target is bossed or bystander-room-target is park room, decide no;
	decide yes.



male-frisbeer-bystander is a bystander. The printed name of male-frisbeer-bystander is "[TQlink of item described]frisbeer[TQxlink of item described][shortcut-desc][verb-desc of item described]". Understand "frisbeer" as male-frisbeer-bystander.
To decide which figure-name is the examine-image of (M - male-frisbeer-bystander):
	decide on figure of male frisbeer bystander.
To decide which number is the awareness of (M - male-frisbeer-bystander):
	decide on 5.
To say ExamineDesc of (M - male-frisbeer-bystander):
	say "This man is throwing a frisbee around, so he is a little distracted.".
Definition: male-frisbeer-bystander is target-room-happy:
	if bystander-room-target is bossed or bystander-room-target is not park room, decide no;
	decide yes.

female-frisbeer-bystander is a bystander. female-frisbeer-bystander is female. The printed name of female-frisbeer-bystander is "[TQlink of item described]frisbeer[TQxlink of item described][shortcut-desc][verb-desc of item described]". Understand "frisbeer" as male-frisbeer-bystander.
To decide which figure-name is the examine-image of (M - female-frisbeer-bystander):
	decide on figure of female frisbeer bystander.
To decide which number is the awareness of (M - female-frisbeer-bystander):
	decide on 5.
To say ExamineDesc of (M - female-frisbeer-bystander):
	say "This woman is throwing a frisbee around, so she is a little distracted.".
Definition: female-frisbeer-bystander is target-room-happy:
	if bystander-room-target is bossed or bystander-room-target is not park room, decide no;
	decide yes.


male-bookworm-bystander is a bystander. The printed name of male-bookworm-bystander is "[TQlink of item described]bookworm[TQxlink of item described][shortcut-desc][verb-desc of item described]". Understand "bookworm" as male-bookworm-bystander.
To decide which figure-name is the examine-image of (M - male-bookworm-bystander):
	decide on figure of male bookworm bystander.
To decide which number is the awareness of (M - male-bookworm-bystander):
	decide on 2.
To say ExamineDesc of (M - male-bookworm-bystander):
	say "This man has his nose in his book[if M is not interested]. Hopefully he won't look up[end if].".
To compute lewd perception reaction of (M - male-bookworm-bystander):
	say "[line break][first custom style]'[one of]I... Oh god!'[or]H...haaah...Hello!'[in random order][roman type][line break][BigNameDesc of M] has turned bright red and you can see that he has a massive erection forming in his pants!".

female-bookworm-bystander is a bystander. female-bookworm-bystander is female. The printed name of female-bookworm-bystander is "[TQlink of item described]bookworm[TQxlink of item described][shortcut-desc][verb-desc of item described]". Understand "bookworm" as male-bookworm-bystander.
To decide which figure-name is the examine-image of (M - female-bookworm-bystander):
	decide on figure of female bookworm bystander.
To decide which number is the awareness of (M - female-bookworm-bystander):
	decide on 2.
To say ExamineDesc of (M - female-bookworm-bystander):
	say "This woman has his nose in her book[if M is not interested]. Hopefully she won't look up[end if].".
To compute lewd perception reaction of (M - female-bookworm-bystander):
	say "[line break][first custom style]'[one of]I... Oh my!'[or]H...haaah...How are you so brave?'[in random order][roman type][line break][BigNameDesc of M] has turned bright red and she is crossing her legs together as if she desperately needs the toilet.".

male-selfie-bystander is a camera-bystander. The printed name of male-selfie-bystander is "[TQlink of item described]selfie addict[TQxlink of item described][shortcut-desc][verb-desc of item described]". Understand "selfie", "addict" as male-selfie-bystander.
To decide which figure-name is the examine-image of (M - male-selfie-bystander):
	decide on figure of male selfie bystander.
To decide which number is the awareness of (M - male-selfie-bystander):
	decide on 5.
To decide which number is the outrage tolerance of (M - male-selfie-bystander):
	decide on 7.
To say ExamineDesc of (M - male-selfie-bystander):
	say "This fashionably dressed man is a bit distracted by his own image. He's spending his entire time making poses and taking selfies of himself.".

female-selfie-bystander is a camera-bystander. female-selfie-bystander is female. The printed name of female-selfie-bystander is "[TQlink of item described]selfie chick[TQxlink of item described][shortcut-desc][verb-desc of item described]". Understand "selfie", "chick" as female-selfie-bystander.
To decide which figure-name is the examine-image of (M - female-selfie-bystander):
	decide on figure of female selfie bystander.
To decide which number is the awareness of (M - female-selfie-bystander):
	decide on 5.
To decide which number is the outrage tolerance of (M - female-selfie-bystander):
	decide on 8.
To say ExamineDesc of (M - female-selfie-bystander):
	say "This confidently dressed woman is a bit distracted by her own image. She's spending her entire time making sexy poses and taking selfies of himself.".

male-skater-bystander is a bystander. The printed name of male-skater-bystander is "[TQlink of item described]skater[TQxlink of item described][shortcut-desc][verb-desc of item described]". Understand "skater" as male-skater-bystander.
To decide which figure-name is the examine-image of (M - male-skater-bystander):
	decide on figure of male skater bystander.
To say ExamineDesc of (M - male-skater-bystander):
	say "This long-haired man is wearing a vest, jeans and skating helmet and pads. He's whizzing a long on his skateboard.".
Definition: male-skater-bystander is strolling: decide yes.
To set up smoothie stats of (M - male-skater-bystander):
	now the bystanderInt1 of M is a random number between 5 and 7; [How much will they enjoy the drink?]
	now the bystanderInt2 of M is a random number between -1 and 2. [How much convincing do they need?]

female-skater-bystander is a bystander. female-skater-bystander is female. The printed name of female-skater-bystander is "[TQlink of item described]skater[TQxlink of item described][shortcut-desc][verb-desc of item described]". Understand "skater" as female-skater-bystander.
To decide which figure-name is the examine-image of (M - female-skater-bystander):
	decide on figure of female skater bystander.
To say ExamineDesc of (M - female-skater-bystander):
	say "This short-haired woman is wearing a T-shirt, shorts and skating helmet and pads. She's whizzing a long on his skateboard.".
Definition: female-skater-bystander is strolling: decide yes.
To set up smoothie stats of (M - female-skater-bystander):
	now the bystanderInt1 of M is a random number between 5 and 7; [How much will they enjoy the drink?]
	now the bystanderInt2 of M is a random number between -1 and 2. [How much convincing do they need?]


male-sunbather-bystander is a bystander. The printed name of male-sunbather-bystander is "[TQlink of item described]sunbathing dude[TQxlink of item described][shortcut-desc][verb-desc of item described]". Understand "sunbathing", "dude" as male-sunbather-bystander.
To decide which figure-name is the examine-image of (M - male-sunbather-bystander):
	decide on figure of male sunbather bystander.
To say ExamineDesc of (M - male-sunbather-bystander):
	say "This man is wearing board shorts and nothing else, clearly very proud of his tanned body and rock hard abs. He's got expensive shades on his face and a beach ball underneath one arm.".
To decide which number is the outrage tolerance of (M - male-sunbather-bystander):
	decide on 10.
To set up smoothie stats of (M - male-sunbather-bystander):
	now the bystanderInt1 of M is a random number between 3 and 9; [How much will they enjoy the drink?]
	now the bystanderInt2 of M is 0. [How much convincing do they need?]
To compute lewd perception reaction of (M - male-sunbather-bystander):
	say "[line break][first custom style]'Holy shit! Come on, that's just too far!'[roman type][line break]".
To compute cringe perception reaction of (M - male-sunbather-bystander):
	say "[line break][first custom style]'Is there something wrong with your brain?!'[roman type][line break]".
To compute non-lewd perception reaction of (M - male-sunbather-bystander):
	say "[big he of M] gives you the 'finger-guns' sign.[if the appearance of the player > 3][line break][first custom style]'Looking fine, shawty! We should hang out some time!'[roman type][line break][end if]".
To compute non-lewd worsened perception reaction of (M - male-sunbather-bystander):
	say "[BigNameDesc of M] grins widely at you.[line break][first custom style]'Now that's what I like to see! Work it, baby!'[roman type][line break]".


female-sunbather-bystander is a bystander. female-sunbather-bystander is female. The printed name of female-sunbather-bystander is "[TQlink of item described]sunbathing babe[TQxlink of item described][shortcut-desc][verb-desc of item described]". Understand "sunbathing babe" as female-sunbather-bystander.
To decide which figure-name is the examine-image of (M - female-sunbather-bystander):
	decide on figure of female sunbather bystander.
To say ExamineDesc of (M - female-sunbather-bystander):
	say "This woman is wearing a rather skimpy blue bikini and sipping from a cool drink. She seems very confident in her own (very tanned) skin.".
To decide which number is the outrage tolerance of (M - female-sunbather-bystander):
	decide on 12.
To set up smoothie stats of (M - female-sunbather-bystander):
	now the bystanderInt1 of M is 1; [How much will they enjoy the drink?]
	now the bystanderInt2 of M is 5. [How much convincing do they need?]
To compute lewd perception reaction of (M - female-sunbather-bystander):
	say "[line break][first custom style]'Come on, you've taken it way too far. What a SLUT!'[roman type][line break]".
To compute cringe perception reaction of (M - female-sunbather-bystander):
	say "[line break][first custom style]'Are you for real?!'[roman type][line break]".
To compute non-lewd perception reaction of (M - female-sunbather-bystander):
	say "[big he of M] gives you a friendly thumbs up.[if the appearance of the player > 3][line break][first custom style]'I LOVE your confidence! You do you, sister! Don't let anyone tell you how to dress!'[roman type][line break][end if]".
To compute non-lewd worsened perception reaction of (M - female-sunbather-bystander):
	say "[BigNameDesc of M] hums with approval.[line break][first custom style]'You flaunt what you got, sister! Ain't no shame in that!'[roman type][line break]".




watchful-bystander is a bystander. watchful-bystander is female. The printed name of watchful-bystander is "[TQlink of item described]watchful woman[TQxlink of item described][shortcut-desc][verb-desc of item described]". Understand "watchful", "woman" as watchful-bystander.
To decide which figure-name is the examine-image of (M - watchful-bystander):
	decide on figure of watchful bystander.
To decide which number is the awareness of (M - watchful-bystander):
	decide on 10.
To decide which number is the outrage tolerance of (M - watchful-bystander):
	decide on 2.


dogwalking-bystander is a bystander. dogwalking-bystander is female. The printed name of dogwalking-bystander is "[TQlink of item described]dogwalking woman[TQxlink of item described][shortcut-desc][verb-desc of item described]". Understand "dogwalking", "woman" as dogwalking-bystander.
To decide which figure-name is the examine-image of (M - dogwalking-bystander):
	decide on figure of dogwalking bystander.
To decide which number is the awareness of (M - dogwalking-bystander):
	decide on 7.
Definition: dogwalking-bystander is strolling if a random number between 1 and 5 > 1.
To compute cupcake perception of (M - dogwalking-bystander):
	say "[BigNameDesc of M] walks up to you and takes a cupcake. ";
	now the charge of skirt-tray-vibrator is 3;
	increase the cakes-taken of skirt-tray-vibrator by 1;
	if the cakes-taken of skirt-tray-vibrator < the max-cakes of skirt-tray-vibrator:
		say "And then [he of M] takes another one![line break][speech style of M]'Are they safe for dogs? Oh, I'm sure it's fine!'[roman type][line break][big he of M] feeds one to [his of M] dog!";
		increase the cakes-taken of skirt-tray-vibrator by 1;
	say skirtTrayBuzzFlav.


idle-bystander is a bystander. The printed name of idle-bystander is "[TQlink of item described]idle man[TQxlink of item described][shortcut-desc][verb-desc of item described]". Understand "idle", "man" as idle-bystander.
To decide which figure-name is the examine-image of (M - idle-bystander):
	decide on figure of idle bystander.
Definition: idle-bystander is strolling: decide no.
To decide which number is the outrage tolerance of (M - idle-bystander):
	decide on 6.

[football-bystander is a bystander. The printed name of football-bystander is "[TQlink of item described]footballer[TQxlink of item described][shortcut-desc][verb-desc of item described]". Understand "footballer" as football-bystander.
To decide which figure-name is the examine-image of (M - football-bystander):
	decide on figure of football bystander.
To decide which number is the outrage tolerance of (M - football-bystander):
	decide on 5.
To decide which number is the cringe tolerance of (M - football-bystander):
	decide on 10.
To compute lewd perception reaction of (M - football-bystander):
	say "[line break][first custom style]'[if the appearance of the player > 8][one of]Holy shit! Are you insane?'[or]What the fuck?!'[or]Oh my god!'[in random order][otherwise][one of]Looking good, sweet-cheeks!'[or]Holy cow, you are HOT!'[or]Oh WOW! I'm going to be thinking about you in bed tonight.'[or]Fuck yeah! You single, babe?'[in random order][end if][roman type][line break]".
To compute cringe perception reaction of (M - football-bystander):
	say "[line break][first custom style]'[one of]Holy shit! Why are you dressed like that?'[or]What the fuck? Is this a fetish thing?!'[in random order][roman type][line break]".


couple-bystander is a bystander. The printed name of couple-bystander is "[TQlink of item described]boyfriend with his girlfriend[TQxlink of item described][shortcut-desc][verb-desc of item described]". Understand "boyfriend", "girlfriend", "with his girlfriend" as couple-bystander.
To decide which figure-name is the examine-image of (M - couple-bystander):
	decide on figure of couple bystander.
To decide which number is the outrage tolerance of (M - couple-bystander):
	decide on 1.
To compute cupcake perception of (M - couple-bystander):
	say "[BigNameDesc of M] walks up to you and takes a cupcake. ";
	now the charge of skirt-tray-vibrator is 3;
	increase the cakes-taken of skirt-tray-vibrator by 1;
	if the cakes-taken of skirt-tray-vibrator < the max-cakes of skirt-tray-vibrator:
		say "And then [he of M] takes another one![line break][speech style of M]'For my girlfriend!'[roman type][line break][big he of M] explains.";
		increase the cakes-taken of skirt-tray-vibrator by 1;
	say skirtTrayBuzzFlav.


engrossed-bystander is a camera-bystander. engrossed-bystander is female. The printed name of engrossed-bystander is "[TQlink of item described]phone-engrossed woman[TQxlink of item described][shortcut-desc][verb-desc of item described]". Understand "phone-engrossed", "engrossed", "woman" as engrossed-bystander.
To decide which figure-name is the examine-image of (M - engrossed-bystander):
	decide on figure of engrossed bystander.
To decide which number is the awareness of (M - engrossed-bystander):
	decide on 2.
Definition: engrossed-bystander is strolling if a random number between 1 and 4 > 3.
To decide which number is the outrage tolerance of (M - engrossed-bystander):
	decide on 7.


janitor-bystander is a bystander. janitor-bystander is female. The printed name of janitor-bystander is "[TQlink of item described]janitor[TQxlink of item described][shortcut-desc][verb-desc of item described]". Understand "janitor" as janitor-bystander.
To decide which figure-name is the examine-image of (M - janitor-bystander):
	decide on figure of janitor bystander.


rich-bystander is a bystander. The printed name of rich-bystander is "[TQlink of item described]rich man[TQxlink of item described][shortcut-desc][verb-desc of item described]". Understand "rich", "man" as rich-bystander.
To decide which figure-name is the examine-image of (M - rich-bystander):
	decide on figure of rich bystander.


police-bystander is a bystander. police-bystander is female. The printed name of police-bystander is "[TQlink of item described]policewoman[TQxlink of item described][shortcut-desc][verb-desc of item described]". Understand "policewoman" as police-bystander.
To decide which figure-name is the examine-image of (M - police-bystander):
	decide on figure of policewoman bystander.]


A game universe initialisation rule:
	let N be 1;
	repeat with M running through bystanders:
		now the text-shortcut of M is the substituted form of "bs[N]";
		increase N by 1;
	change the north exit of Predicament20 to School01. [It's a one-way journey]

A time based rule (this is the bystanders move rule):
	if the player is in an unbossed predicament room or the player is in Predicament02:
		update appearance level; [We really want to make sure we've got this accurate]
		repeat with M running through alive bystanders:
			if debugmode > 1, say "Computing [NameDesc of M] ([location of M]).";
			if M is not moved, compute movement of M;
			now M is not moved;
			check perception of M;
		[display entire map.]

To set up bystanders for (P - a predicament):
	set up 16 bystanders.

To set up (N - a number) bystanders:
	let LB be the list of bystanders;
	repeat with M running through LB:
		destroy M;
	sort LB in random order;
	truncate LB to N entries;
	repeat with M running through LB:
		now M is in a random unbossed predicament room;
		now M is uninterested;
		now the worst-appearance of M is 0;
		if a random number between 1 and 7 is 1 or M is in Predicament03 or M is in Toilet01 or M is in Toilet02, now M is in Park05;
		now M is moved; [stops them moving instantly]


A time based rule (this is the cars come past rule):
	if the player is in an unbossed predicament room:
		if the player is not in a park room and (current-predicament is not smoothie-predicament or the player is not in Predicament03) and a random number between 1 and 4 is 1:
			say "[bold type]Suddenly, a car [one of]comes driving[or]zooms[or]drives[or]sails[at random] past! [roman type]";
			if the appearance of the player > 2 or the cringe appearance of the player > 4:
				say "The driver honks [his of shopkeeper] horn as [he of shopkeeper] spots you!";
				if a random number between 1 and 2 is 1:
					choose a blank row in Table of Published Disgraces;
					now the content entry is the substituted form of "low resoution dashcam footage of [PredicamentActivity of current-predicament]";
					now the published entry is the substituted form of "has been uploaded to www.caughtondashcam.net";
					now the severity entry is the appearance of the player;
					now the popularity entry is 2;
					now the timestamp entry is time-earnings;
					say "[variable custom style][one of]Wait, did he have a dashcam?! Does that count as a recording???[or]Shit, I think I've been caught on a dashcam again![stopping][roman type][line break]";
					strongHumiliate;
				otherwise:
					say strongHumiliateReflect;
				repeat with M running through uninterested bystanders:
					if M is not reactive:
						now neighbour finder is the location of M;
						let A be the best route from the location of M to the location of the player;
						let P be the room A from (the location of M);
						if A is a direction and a random number between 1 and 5 > 3 and the number of barriers in P is 0 and the number of barriers in the location of M is 0, try M going A;
					if M is reactive:
						now M is interested;
						compute perception of M;
			otherwise:
				say line break.





A predicament is a kind of thing. A predicament is not portable.
A predicament has a number called times-completed.
A team-predicament is a kind of predicament.
team-predicament-partner is an object that varies.
Definition: a predicament is appropriate: decide no.
Definition: yourself is predicament-ready:
	if the latex-transformation of the player > 0, decide no;
	if (class-time is 1000 or class-time < 0) and armband is worn and armband is not solid gold and there is an alive undefeated correctly-ranked teacher, decide no; [ready for class]
	if there is worn locked clothing, decide no;
	repeat with C running through worn clothing:
		if C is unremovable and C is not piercing, decide no;
		if C is cursed and the quest of C is next-lesson-quest, decide no;
		if C is christmas dress and the class of the player is santa's little helper, decide no;
	decide yes.
Definition: a predicament is eligible if the times-completed of it is 0.
Definition: a team-predicament is eligible if the times-completed of it is 0 and team-predicament-partner is a monster.
To execute (P - a predicament):
	do nothing.

To decide which text is PredicamentActivity of (P - a predicament):
	decide on "you [one of]sneaking through[or]rushing through[in random order] [if the player is in a park room]a public park[otherwise]your neighbourhood[end if]".
current-predicament is an object that varies.




To say PredicamentRewardExplanation:
	say "[one of]HERE YOU CAN EARN TROPHIES WHICH MAY BE USEFUL ASSETS THROUGHOUT THE REST OF YOUR TRAINING. PLEASE NOTE, IT IS RECOMMENDED TO MOVE THROUGH THIS AREA WITH AS MODEST AN APPEARANCE AS POSSIBLE TO AVOID EMBARRASSING ENCOUNTERS WITH YOUR NEIGHBOURS. ALL YOUR ITEMS AND YOUR NEW TROPHY ARE WAITING FOR YOU IN THE DESTINATION LOCATION. PLEASE NOTE[or]ANOTHER TROPHY IS WAITING FOR YOU AT THE DESTINATION LOCATION. PLEASE REMEMBER[stopping]: ALL PHOTOS AND VIDEOS TAKEN ARE UPLOADED TO THE *REAL* INTERNET. YOUR REAL PUBLIC REPUTATION IS AT STAKE. ".
To say PredicamentRewardExplanationReaction:
	say "[one of][line break][variable custom style]How cryptic. [if the player is shameless]So photos of me can get uploaded to the real life Internet? How outrageous... and exciting![otherwise]But one thing is clear: if there's chances of photos of me being uploaded to the real life Internet, then I really must be careful here...[end if][or][stopping]".




simple-sneak-predicament is a predicament.
Figure of simple sneak predicament is the file "Special/Cutscene/cutscene-predicament-diaper-sneak1.jpg".
Definition: simple-sneak-predicament is appropriate if armband is sapphire.
To execute (SSP - simple-sneak-predicament):
	if diaper quest is 1:
		let P be a random pink leotard;
		blandify and reveal P;
		now P is in Predicament01;
		let P be a random baby booties;
		blandify and reveal P;
		now P is in Predicament01;
		now the raw-magic-modifier of P is 1;
		now P is dexterity-influencing;
		let D be plain-largish-diaper;
		summon D uncursed;
		now D is locked;
	otherwise:
		let T be a random sexy exercise bra;
		now the size of T is the largeness of breasts;
		if the size of T > the max size of T, now the size of T is the max size of T;
		if the size of T < the min size of T, now the size of T is the min size of T;
		if the size of T < the largeness of breasts:
			now T is a random white string bikini top;
			now T is confidence;
		if the largeness of breasts <= 1, now T is a random polo shirt;
		blandify and reveal T;
		now T is in Predicament01;
		let M be a random black sporty microskirt;
		blandify and reveal M;
		now M is in Predicament01;
		now M is speed;
		now the raw-magic-modifier of M is a random number between 0 and 2;
		let C be white-cameltoe briefs;
		if the player is male, now C is pink-kitty-panties;
		blandify and reveal C;
		now C is in Predicament01;
	now the printed name of Predicament01 is "Small Room";
	now the player is in Predicament01;
	say "You find yourself in a small room, empty except for a wardrobe, a small table and a front door that leads outside. You are completely naked[if diaper quest is 1] except for a [MediumDesc of plain-largish-diaper][end if]. The table has a piece of card on it with the word 'INSTRUCTIONS' on it. You read the instructions:[paragraph break][first custom style]'WELCOME TO EXTRA CREDIT CLASS. [PredicamentRewardExplanation]TO EARN THIS TROPHY, YOU MUST SIMPLY... RETURN HOME.'[PredicamentRewardExplanationReaction][roman type][line break]It looks like your outfit has been decided for you...";
	if diaper quest is 1, cutshow figure of simple sneak predicament.





vibe-photo-predicament is a predicament. The printed name of vibe-photo-predicament is "[TQlink of item described]wand vibrator[TQxlink of item described][shortcut-desc]". Understand "vibrator" as vibe-photo-predicament. The text-shortcut of vibe-photo-predicament is "wand".
To say ExamineDesc of (V - vibe-photo-predicament):
	say "This wand vibrator has a green circle towards the rear of its tip and a red diamond towards the front. You'll need to obscure the green circle by putting your crotch directly onto the tip, in order to satisfy the camera's requirements.".
vibe-photo-predicament has a number called camera-countdown.
vibe-photo-predicament can be position-adopted.
To decide which figure-name is the examine-image of (V - vibe-photo-predicament):
	if V is position-adopted or blue-exercise-shorts is held or blue-exercise-shorts is in Predicament01, decide on figure of vibe pose predicament 2;
	decide on figure of vibe pose predicament 1.
Definition: vibe-photo-predicament is appropriate if armband is sapphire and ((diaper quest is 0 and the player is a december 2019 top donator) or (diaper quest is 1 and the player is a december 2019 diaper donator)).
To execute (VPP - vibe-photo-predicament):
	now the stance of the player is 0;
	if diaper quest is 1:
		let D be pink-huge-diaper;
		summon D uncursed;
		now D is locked;
	otherwise:
		summon predicament-painted-cutoffs uncursed;
		now predicament-painted-cutoffs is hand-blocked;
	now the camera-countdown of VPP is (a random number between 1 and 6) + (a random number between 0 and 5);
	now VPP is in Predicament01;
	now the player is in Predicament01;
	say "You find yourself in a small room, empty except for a camera on a tripod pointing at a wand vibrator, fixed vertically to a pole in the ground, and a locked cabinet containing a crop top and loose-fitting exercise shorts. You are completely naked except for a [if diaper quest is 1][MediumDesc of pink-huge-diaper] which has been locked around you waist with a padlock[otherwise]spraypainting of demin cutoffs which would hopefully fool someone who wasn't standing too closely[end if]. There are green dots painted onto the backs of your hands, the backs of your index and middle fingers, the front of your other six fingers, on the tip of the wand vibrator, [if diaper quest is 1]at the crotch of your diaper, [end if]and on wall either side of you at chest height. A robotic voice can suddenly be heard from a hidden speaker:[paragraph break][first custom style]'WELCOME TO EXTRA CREDIT CLASS. [PredicamentRewardExplanation]TO EARN THIS TROPHY, YOU MUST SIMPLY... RETURN HOME. TO UNLOCK THE BONUS CLOTHING, PLEASE ENSURE THAT THE CAMERA CANNOT DETECT ANY GREEN, AND CAN SEE FOUR SPOTS OF RED IN A DIAMOND SHAPE - YOUR TONGUE, NIPPLES AND [if diaper quest is 1]VIBRATOR[otherwise]CROTCH[end if]. THE CAMERA WILL ONLY TAKE ONE PHOTO, AT A RANDOM TIME IN THE NEAR FUTURE. THIS PHOTO WILL BE PUBLISHED ONLINE AND LINKED TO YOUR SOCIAL MEDIA ACCOUNT.'[PredicamentRewardExplanationReaction][roman type][line break]The 'predicament' seems simple. You must either walk home looking as you are, or pose in a way which meets the unlocking criteria - with your crotch pressed into the wand vibrator, your hands up to your sides showing 'peace signs', and your tongue lolling out of your mouth. And who knows exactly when the camera will go off...".

To decide which number is the stimulation of (D - vibe-photo-predicament) on (B - a body part):
	decide on a random number between 15 and 20.

A time based rule:
	if current-predicament is vibe-photo-predicament:
		decrease the camera-countdown of vibe-photo-predicament by 1;
		if the player is in Predicament01:
			if the player is upright and the camera-countdown of vibe-photo-predicament > -100:
				say "[if vibe-photo-predicament is position-adopted]Continue to hold[otherwise]Adopt[end if] the correct pose for the photo[one of] immediately[or][stopping]? ";
				if the player is consenting:
					say "You hold your hands up into peace signs, push your tongue lewdly out of your mouth, and [if vibe-photo-predicament is position-adopted]continue to push[otherwise]lower[end if] your [genitals] onto the vibrator. The stimulation is intense!";
					stimulate vagina from vibe-photo-predicament;
					if the player is upright, now vibe-photo-predicament is position-adopted;
					otherwise now vibe-photo-predicament is not position-adopted;
				otherwise:
					say "You [if vibe-photo-predicament is position-adopted]pull away from the vibrator and step[otherwise]hold back for now, and stay[end if] out of the camera's vision.";
					now vibe-photo-predicament is not position-adopted;
			if the camera-countdown of vibe-photo-predicament is 0:
				now the camera-countdown of vibe-photo-predicament is -100; [the player knows that the camera already flashed so has no motivation to straddle the vibrator any more]
				say "[italic type]FLASH![roman type][line break]The camera takes its photo.";
				if vibe-photo-predicament is position-adopted:
					say "You hear a series of high pitched electronic tones, declaring that the camera failed to detect the pattern it was looking for. The cabinet unlocks! However, you also hear the sound of a file being uploaded. Uh-oh.[line break][variable custom style]My friends are going to be able to see this! How humiliating![roman type][line break]";
					blandify and reveal baby doll crop top;
					now baby doll crop top is in the location of the player;
					blandify and reveal blue-exercise-shorts;
					now blue-exercise-shorts is in the location of the player;
					choose a blank row in Table of Published Disgraces;
					now the content entry is the substituted form of "a high resolution photo of you posing with peace signs, tongue lolled out and [genitals] pushed into a vibrating wand, [ReputationAttire]";
					now the published entry is the substituted form of "has been [one of]uploaded to[or]posted on[purely at random] your social media profile";
					now the severity entry is 100;
					now the popularity entry is 0;
					now the timestamp entry is 0;
					[by setting these to 0, the 'views' will be set to 1, which means there's no tracked views and the reputation damage is flat severity]
				otherwise:
					say "You hear a series of low electronic tones, declaring that the camera failed to detect the pattern it was looking for.[line break][variable custom style]Well, there goes my only chance to get some proper clothes...[roman type][line break]".







triple-dildo-predicament is a predicament. The printed name of triple-dildo-predicament is "dildo".
triple-dildo-predicament has a number called pill-timer. The pill-timer of triple-dildo-predicament is -1000.
Definition: triple-dildo-predicament is appropriate if diaper quest is 0 and the player is female and the pill-timer of triple-dildo-predicament is -1000 and the rank of the player >= 3.
To decide which number is the girth of (P - triple-dildo-predicament):
	decide on 5.
To say FuckerDesc of (P - triple-dildo-predicament):
	say "the dildo".
To say BigFuckerDesc of (P - triple-dildo-predicament):
	say "The dildo".
Definition: triple-dildo-predicament is insertable: decide yes. [Allows it to cause stimulation]
Figure of triple dildo predicament is the file "Special/Cutscene/cutscene-predicament-triple-dildo1.jpg".
To execute (P - triple-dildo-predicament):
	now the player is in Predicament01;
	display entire map;
	now temporaryYesNoBackground is Figure of triple dildo predicament;
	now the stance of the player is 1;
	let E be grey-exercise-shorts;
	now E is in Predicament01;
	now E is blessed;
	now E is sure;
	now E is identified;
	now the raw-magic-modifier of E is 1;
	now triple-dildo-predicament is penetrating face;
	now triple-dildo-predicament is penetrating vagina;
	now triple-dildo-predicament is penetrating asshole;
	now the stomach-semen of the player is 0;
	now the stomach-water of the player is 1;
	now refactoryperiod is 0;
	say "[bold type]Suddenly you can feel that your arms are tightly bound behind you, with your hands in fingerless mittens, and there are thick dildos in your throat, pussy and ass![roman type][line break]A mechanical voice begins to explain your predicament.[line break][first custom style]'THE RULES ARE AS FOLLOWS: THE TANK OF SEMEN IN FRONT OF YOU IS CONNECTED TO YOUR BODY BY THREE TUBES. THE MOUTH AND CUNT TUBES ARE CURRENTLY LOCKED IN PLACE. YOU CAN PUMP SEMEN DOWN YOUR THROAT BY SQUEEZING ON THE DILDO IN YOUR MOUTH. YOU CAN PUMP SEMEN UP YOUR ASSHOLE BY BOUNCING ON THE STUDDED ANAL DILDO ON THE CHAIR BELOW YOU.[paragraph break]'AFTER TWO MINUTES, ANYTHING REMAINING IN THE SEMEN TANK WILL BE DUMPED INTO YOUR FERTILE PUSSY, AND THE LOCK HOLDING THE EXERCISE SHORTS IN THE CABINET BEHIND YOU WILL ENTER A PERMANENT LOCKED STATE. HOWEVER AS SOON AS THE SEMEN TANK IS EMPTY, ALL THE BONDAGE WILL FALL UNLOCKED AND YOU WILL BE ABLE TO ACCESS THE EXERCISE SHORTS. SO IF YOU CAN EMPTY THE TANK WITHIN TWO MINUTES, YOU WILL HAVE SOMETHING TO WEAR WHEN YOU LEAVE.[paragraph break]'FINALLY, IF YOU DO GET CREAMPIED, THERE IS A MORNING AFTER PILL WAITING FOR YOU IN YOUR HOUSE. BUT IT WILL BE DESTROYED EXACTLY 45 SECONDS AFTER THE TANK EMPTIES.[paragraph break]'GO.'[roman type][line break]";
	say "The analog timer at the base of the semen tank starts ticking down!";
	let T be 120;
	let S be 100;
	while T > 0 and S > 0:
		let A be 0;
		let M be 0;
		say "The tank is [S]% full. There are about [T] seconds left on the timer.[line break]Do you squeeze on the dildo in your mouth?";
		decrease T by 10;
		if the player is consenting:
			now M is 1;
		say "And do you ride the dildo in your [asshole]?";
		if the player is consenting:
			now A is 1;
		if M is 1:
			say "Thick warm [semen] flows straight down your throat.";
			decrease S by 3;
			StomachSemenUp 1;
			if the stomach-semen of the player > 2, PukeUp;
		if A is 1:
			say "You spend the next ten seconds pumping up and down on the dildo. ";
			now sex-hurt-balance is 10; [Each tick of asshole ruining should cause delicatness or fainting chance at maximum soreness]
			if refactoryperiod > 0:
				decrease refactoryperiod by 1;
				say "[bold type]But due to your fatigue from your recent orgasm, your pumping is much slower than before![roman type][line break]";
				AssFill 1;
				decrease S by 3;
				ruin asshole;
			otherwise:
				say "You feel the goopy stuff flowing straight through to your innards.";
				AssFill 3;
				decrease S by 9;
				ruin asshole times 2;
		otherwise:
			if the soreness of asshole > 0, say "Giving your [asshole] a break has made it feel a little less tender.";
			heal asshole times 1;
			cool down 1500;
		check for arousal change;
	if S > 0:
		say "[bold type]DING DING DING![roman type][line break]You are held still as the tank dumps [if S > 30]insane amounts of[otherwise if S > 10]huge amounts of[otherwise]the remaining[end if] [semen] into your [vagina]! Meanwhile, a *clunk* lets you know that the cabinet holding the shorts is now permanently locked tight.";
		only destroy E;
		now a random creampie pole trap is inseminating vagina;
		PussyFill S / 3;
		now the pill-timer of triple-dildo-predicament is 10000;
	otherwise:
		now the pill-timer of triple-dildo-predicament is 0; [still don't want this predicament to happen again]
	dislodge triple-dildo-predicament;
	say "Suddenly, in the same moment, all the bondage holding you falls apart at the seams and clatters to the floor. You are able to pull all three dildos out of your body[if S > 0]! You want to expel the [semen] from your [asshole], but surely that'll make you lose time, and [bold type]you only have 45 seconds to race for the morning after pill[end if]![roman type][line break]".

A time based rule (this is the triple dildo punishment pill rule):
	if the pill-timer of triple-dildo-predicament > 0:
		decrease the pill-timer of triple-dildo-predicament by time-seconds;
		if the player is in Predicament20:
			if the pill-timer of triple-dildo-predicament > 99955:
				say "[bold type]You manage to grab the pill before it's dropped down a drain. [roman type]You quickly swallow it!";
				if the pregnancy of the player > 0:
					now the pregnancy of the player is 0;
					say "You feel it immediately working to reverse the effects of the pregnancy.";
				otherwise:
					say "You feel it immediately working to avoid any chance of pregnancy.";
				cancel father material;
			otherwise if the pill-timer of triple-dildo-predicament + time-seconds > 99955:
				say "[bold type]You arrive just in time to watch with [horror the semen addiction of the player] as the morning after pill is released from a metal claw and dropped down a drain! [roman type]You were so close!!!";
			otherwise:
				say "[bold type]When you arrive, you can see an open metal claw above a drainpipe. [roman type]The morning after pill must have been dropped down here when the timer ran out...";
			now the pill-timer of triple-dildo-predicament is 0;
		otherwise if the player is not in a predicament room:
			now the pill-timer of triple-dildo-predicament is 0. [failsafe]


painted-cutoffs-predicament is a predicament.
painted-cutoffs-predicament has a number called predicament-completed.
Definition: painted-cutoffs-predicament is appropriate if the player is female and ((the predicament-completed of painted-cutoffs-predicament is 0 and the rank of the player is 2) or (the predicament-completed of painted-cutoffs-predicament < 3 and the rank of the player is 3)) and the player is able to get horny.
Definition: painted-cutoffs-predicament is eligible if diaper quest is 0 and ((the times-completed of it is 0 and the rank of the player is 2) or (the times-completed of it < 2 and the rank of the player is 3)).
Figure of painted cutoffs predicament is the file "Special/Cutscene/cutscene-painted-cutoffs-predicament1.jpg".
To set up bystanders for (P - painted-cutoffs-predicament):
	set up 13 bystanders.
To execute (P - painted-cutoffs-predicament):
	now the player is in Predicament02;
	display entire map;
	now predicament-painted-cutoffs is worn by the player;
	now predicament-painted-cutoffs is sure;
	now predicament-painted-cutoffs is identified;
	now predicament-painted-cutoffs is not hand-blocked;
	now predicament-painted-cutoffs is hand-decided;
	now painted-vibrator-hands is worn by the player;
	now painted-vibrator-hands is sure;
	now painted-vibrator-hands is identified;
	let C be a random pink tube top;
	summon C uncursed;
	let C be a random satin court heels;
	summon C uncursed;
	now C is cursed;
	now the quest of C is predicament-quest;
	now the heel-height of C is 2;
	let C be a random frilly stockings;
	summon C uncursed;
	now refactoryperiod is 0;
	if the rank of the player < 3:
		now the predicament-completed of painted-cutoffs-predicament is 1;
		say "Suddenly you find yourself standing outside, in an alleyway. Round the corner, the noise of a road and the distant sound of voices can be heard. A robotic voice speaks from a speaker in the wall behind you.[line break][first custom style]'WELCOME TO THE [']EXTRA CREDIT['] CLASS. [PredicamentRewardExplanation]TO EARN THIS TROPHY, YOU MUST SIMPLY... RETURN HOME.[paragraph break]'GO.'[PredicamentRewardExplanationReaction][roman type][paragraph break]Looking down at yourself, you begin to realise the challenge. You're wearing a tight pink tube top which shows your nipples straight through it. Your feet are stuck in white stockings and black court heels. And the only other thing on your body is... [UniqueClothingDesc of predicament-painted-cutoffs][ClothingDesc of painted-vibrator-hands][variable custom style]Holy crap...[roman type][line break]";
	otherwise:
		say "Suddenly you find yourself standing outside, in an alleyway. On the ground, a heavy wooden box holds a stack of ping pong balls. Round the corner, the noise of a road and the distant sound of voices can be heard. A robotic voice speaks from a speaker in the wall behind you.[line break][first custom style]'WELCOME TO THE SUPER FUN ['][if egg laying fetish is 0]PING PONG[otherwise]EGG[end if] TRANSFER CHALLENGE['] EXTRA CREDIT CLASS. [PredicamentRewardExplanation]THE RULES ARE AS FOLLOWS: MOVE ALL TWENTY PING PONG BALLS FROM THIS BOX TO YOUR DRIVEWAY. THE DOOR TO YOUR HOUSE WILL THEN AUTOMATICALLY UNLOCK.[paragraph break]'GO.'[PredicamentRewardExplanationReaction][roman type][paragraph break]Looking down at yourself, you [if the predicament-completed of painted-cutoffs-predicament is not 0]are wearing the same get-up as before, with a tight pink tube top, white stockings and black court heels. [UniqueClothingDesc of predicament-painted-cutoffs][ClothingDesc of painted-vibrator-hands][otherwise]begin to realise the challenge. You're wearing a tight pink tube top which pretty much shows your nipples straight through it. Your feet are stuck in white stockings and black court heels. And the only other thing on your body is... [UniqueClothingDesc of predicament-painted-cutoffs][ClothingDesc of painted-vibrator-hands][variable custom style]Holy crap...[roman type][line break][end if]";
		now the predicament-completed of painted-cutoffs-predicament is 3;
		repeat with N running from 1 to 20:
			let E be a random available small egg;
			now E is in Predicament02.


Check going east when the player is in Predicament19:
	if the predicament-completed of painted-cutoffs-predicament is 3 and the number of small egg in the location of the player < 20, say "The door's locked! You need to get all 20 [ShortDesc of a random small egg]s onto the ground here for it to unlock..." instead.











serving-tray-predicament is a predicament.
Definition: serving-tray-predicament is appropriate if the rank of the player is (2 + diaper quest) and the player is able to get horny.
To set up bystanders for (P - serving-tray-predicament):
	set up 23 bystanders.

To decide which text is PredicamentActivity of (P - serving-tray-predicament):
	decide on "you giving out free cupcakes in humiliating attire [if the player is in a park room]a public park[otherwise]your neighbourhood[end if]".

Figure of serving tray predicament 1 is the file "Special/Cutscene/cutscene-predicament-serving-tray1.jpg".
Figure of serving tray predicament 2 is the file "Special/Cutscene/cutscene-predicament-serving-tray2.jpg".
Figure of serving tray predicament 3 is the file "Special/Cutscene/cutscene-predicament-serving-tray3.jpg".
Figure of serving tray predicament 4 is the file "Special/Cutscene/cutscene-predicament-serving-tray4.jpg".
To execute (P - serving-tray-predicament):
	now the player is in Predicament02;
	display entire map;
	let C be a random pink tube top;
	summon C uncursed;
	let C be a random satin court heels;
	summon C uncursed;
	now C is cursed;
	now the quest of C is predicament-quest;
	now the heel-height of C is 2;
	let C be a random frilly stockings;
	summon C uncursed;
	now refactoryperiod is 0;
	if diaper quest is 1:
		let C be plain-largish-diaper;
		summon C uncursed;
		now skirt-tray-vibrator is worn by the player;
		now skirt-tray-vibrator is unskirted;
	otherwise:
		now skirt-tray-vibrator is in Predicament02;
	now the stance of the player is 0;
	say "Suddenly you find yourself standing outside, in an alleyway. Round the corner, the noise of a road and the distant sound of voices can be heard. A robotic voice speaks from a speaker in the wall behind you.[line break][first custom style]'WELCOME TO THE [']EXTRA CREDIT['] CLASS. [PredicamentRewardExplanation]THE SKIRT YOU HAVE BEEN PROVIDED COMES WITH A SERVING TRAY. WHENEVER A CAKE IS REMOVED FROM ITS PRESSURE PAD, THE VIBRATOR WILL TURN ON FOR 15 SECONDS. THE INTENSITY OF THE VIBRATION DEPENDS ON HOW MANY CAKES HAVE BEEN TAKEN. IF ALL CAKES ARE REMOVED FROM THEIR PRESSURE PADS, THE VIBRATOR WILL TURN PERMANENTLY ON, STUCK AT MAXIMUM POWER.[paragraph break]'GO.'[PredicamentRewardExplanationReaction][roman type][paragraph break]Looking down at yourself, you begin to realise the challenge. You're wearing a tight pink tube top which shows your nipples straight through it, with the phrase 'FREE SAMPLES' on the front. Your feet are stuck in black court heels. And [if diaper quest is 1 and the player is female]the only other thing on your body is a large white diaper with a subtle hole under your [vagina]. Attached to it and currently in your hands[otherwise if diaper quest is 1]the only other thing on your body is a large white diaper. Attached to it and currently in your hands[otherwise]your bottom half is currently completely naked. On the ground in front of you[end if] is a [skirt-tray-vibrator][paragraph break][ClothingDesc of skirt-tray-vibrator][variable custom style]Holy crap...[roman type][line break]".









maths-sex-predicament is a predicament.
Definition: maths-sex-predicament is appropriate if the rank of the player >= 3 - diaper quest.
To set up bystanders for (P - maths-sex-predicament):
	set up 13 + (diaper quest * 5) bystanders.

A maths-sex-predicament-puzzle is a kind of object. A maths-sex-predicament-puzzle has a text called puzzle-text. A maths-sex-predicament-puzzle has a number called the maths-answer.
There are 5 maths-sex-predicament-puzzle.
To set up (P - a maths-sex-predicament-puzzle) with difficulty (N - a number):
	let X be a random number between 1 and 9;
	let T be the substituted form of "[X]";
	repeat with M running from 0 to N:
		let Y be a random number between -9 and 9;
		if M is N, now Y is (maths-answer of P) - X;
		increase X by Y;
		unless Y is 0:
			if Y > 0, now T is the substituted form of "[T] + [Y]";
			otherwise now T is the substituted form of "[T] - [Y * -1]";
	now the puzzle-text of P is T.

A maths-sex-predicament-punishment is a kind of object.
Definition: a maths-sex-predicament-punishment is appropriate if diaper quest is 0.

To compute maths-sex:
	now current-monster is a random monster penetrating a body part;
	while current-monster is penetrating a body part:
		follow the default continue sex rules;
		check for arousal change;
		render buffered stuff;
	say "The [man of current-monster] leaves the way [he of current-monster] came.".


leave-me-alone is a maths-sex-predicament-punishment.
Definition: leave-me-alone is appropriate: decide no.
To decide which text is the maths-punishment-description of (M - leave-me-alone):
	decide on "Leave me alone".
To maths-execute (M - leave-me-alone):
	say "You hear [if diaper quest is 1]a series of electronic tones that sound somewhat disappointed[otherwise]the [man of shopkeeper] harrumph in disappointment, before leaving the way [he of shopkeeper] came[end if].".

condom-anal is a maths-sex-predicament-punishment.
To decide which text is the maths-punishment-description of (M - condom-anal):
	decide on "Fuck me in the ass with a condom, then tie it to my belt".
To maths-execute (M - condom-anal):
	let A be a random ultimate-lesson-actor;
	say "You hear the [man of A] exclaim with glee!";
	now A is wrapped;
	compute A entering asshole;
	compute maths-sex.

bareback-anal is a maths-sex-predicament-punishment.
To decide which text is the maths-punishment-description of (M - bareback-anal):
	decide on "Fuck me in the ass bareback and cum inside".
To maths-execute (M - bareback-anal):
	let A be a random ultimate-lesson-actor;
	say "You hear the [man of A] exclaim with glee!";
	now A is unwrapped;
	compute A entering asshole;
	compute maths-sex.

condom-vaginal is a maths-sex-predicament-punishment.
Definition: condom-vaginal is appropriate if the player is female and diaper quest is 0.
To decide which text is the maths-punishment-description of (M - condom-vaginal):
	decide on "Fuck me in the pussy with a condom, then tie it to my belt".
To maths-execute (M - condom-vaginal):
	let A be a random ultimate-lesson-actor;
	say "You hear the [man of A] exclaim with glee!";
	now A is wrapped;
	compute A entering vagina;
	compute maths-sex.

bareback-vaginal is a maths-sex-predicament-punishment.
Definition: bareback-vaginal is appropriate if the player is female and diaper quest is 0.
To decide which text is the maths-punishment-description of (M - bareback-vaginal):
	decide on "Fuck me in the pussy bareback and cum inside".
To maths-execute (M - bareback-vaginal):
	let A be a random ultimate-lesson-actor;
	say "You hear the [man of A] exclaim with glee!";
	now A is unwrapped;
	compute A entering vagina;
	compute maths-sex.

jizz-on-me is a maths-sex-predicament-punishment.
Definition: jizz-on-me is appropriate if bukkake fetish is 1.
To decide which text is the maths-punishment-description of (M - jizz-on-me):
	decide on "Masturbate until you cum all over my butt".
To maths-execute (M - jizz-on-me):
	say "You hear the [man of shopkeeper] chuckle and whip out [his of shopkeeper] [manly-penis]. It's not long before you hear [him of shopkeeper] grunting and feel the warmth of [his of shopkeeper] seed on your [AssDesc]! After that, you hear [him of shopkeeper] leave the way [he of shopkeeper] came.";
	squirt semen on hips by 2.

spank-my-butt is a maths-sex-predicament-punishment.
Definition: spank-my-butt is appropriate: decide yes.
[To decide which text is the maths-punishment-description of (M - spank-my-butt):
	decide on "Spank my ass 3 times or until you hear me thank you properly".
To maths-execute (M - spank-my-butt):
	say "You hear the [man of shopkeeper] chuckle. And then... THWACK! A strong blow lands on your rear. You let out an involuntary squeal.[line break]Do you ".]
To decide which text is the maths-punishment-description of (M - spank-my-butt):
	decide on "Spank my ass 3 times".
To maths-execute (M - spank-my-butt):
	say "You hear [if diaper quest is 0]the [man of shopkeeper] chuckle[otherwise]a robotic arm whirring into action[end if]. And then... THWACK! A strong blow lands on your rear. You let out an involuntary squeal.";
	PainUp 1;
	if diaper quest is 0:
		say "And then another. THWACK!";
		PainUp 1;
	otherwise:
		say "And then another. THWACK! The thick padding on your rear helps endure the brutal assault, but it still really hurts.";
	say "And finally a third. THWACK! This one stings even more than the other two!";
	PainUp 1;
	if diaper quest is 0, say "Satisfied, the [man of shopkeeper] leaves the way [he of shopkeeper] came.".

spank-my-butt-small is a maths-sex-predicament-punishment.
Definition: spank-my-butt-small is appropriate if diaper quest is 1.
To decide which text is the maths-punishment-description of (M - spank-my-butt-small):
	decide on "Spank my ass 2 times".
To maths-execute (M - spank-my-butt-small):
	say "You hear a robotic arm whirring into action. And then... THWACK! A strong blow lands on your rear. You let out an involuntary squeal.";
	PainUp 1;
	say "And then another. THWACK! The thick padding on your rear helps endure the brutal assault, but it still really hurts.".

spank-my-butt-large is a maths-sex-predicament-punishment.
Definition: spank-my-butt-large is appropriate if diaper quest is 1.
To decide which text is the maths-punishment-description of (M - spank-my-butt-large):
	decide on "Spank my ass 10 times".
To maths-execute (M - spank-my-butt-large):
	say "You hear a robotic arm whirring into action. And then... THWACK! A strong blow lands on your rear. You let out an involuntary squeal.";
	PainUp 1;
	say "And then another. THWACK! The thick padding on your rear helps endure the brutal assault, but it still really hurts. And you still have eight more to go...";
	PainUp 1;
	say "THWACK! THWACK! THWACK! THWACK! It's almost too much to bear!";
	PainUp 1;
	if the bladder of the player > (bladder-risky-level / 2):
		say "The pain of the spanking episode causes you to involuntarily wet yourself.";
		now delayed urination is 1;
		try urinating;
	say "THWACK! THWACK!";
	PainUp 1;
	if rectum > 1 and rectum < the delicateness of the player:
		say "The pain is so intense that you can't help but mess yourself.";
		compute messing;
	say "THWACK! THWACK! By the time it's finished, you are reduced to a quivering mess.";
	PainUp 1.


make-me-cum is a maths-sex-predicament-punishment.
Definition: make-me-cum is appropriate: decide yes.
To decide which text is the maths-punishment-description of (M - make-me-cum):
	decide on "Force me to cum with the wand vibrator".
To maths-execute (M - make-me-cum):
	say "You hear [if diaper quest is 1]a powerful vibrator whirr into motion as it is pressed[otherwise]the [man of shopkeeper] switch on the vibrator in question, and press it[end if] against your [genitals]. It's so strong! It's not long before your legs are shaking and blood is rushing to your head...";
	passively stimulate vagina from drink-machine times 2;
	check for arousal change;
	vaginally orgasm shamefully;
	if diaper quest is 0, say "The [man of shopkeeper] leaves the way [he of shopkeeper] came.".

new-ass-tattoo is a maths-sex-predicament-punishment.
Definition: new-ass-tattoo is appropriate if diaper quest is 0 and there is a worn tattoo and the number of worn ass tattoo is 0.
To decide which text is the maths-punishment-description of (M - new-ass-tattoo):
	decide on "Write something degrading on my ass with permanent ink".
To maths-execute (M - new-ass-tattoo):
	say "You hear the [man of shopkeeper] chuckle and pull the lid off of a permanent marker. And then you feel [him of shopkeeper] write 'just the tip' on your ass![line break][variable custom style]Really?![roman type][line break]";
	summon just the tip tattoo;
	say "The [man of shopkeeper] leaves the way [he of shopkeeper] came, taking the pen with [him of shopkeeper].".


new-ankle-tattoo is a maths-sex-predicament-punishment.
Definition: new-ankle-tattoo is appropriate if there is a worn tattoo and new-ass-tattoo is not appropriate and spank-me-heart tattoo is not worn.
To decide which text is the maths-punishment-description of (M - new-ankle-tattoo):
	decide on "Give me a new ankle tattoo".
To maths-execute (M - new-ankle-tattoo):
	say "You hear the [if diaper quest is 0][man of shopkeeper] think to [himself of shopkeeper] carefully[otherwise]robotic arm whirr into action[end if] and then you hear a tattoo needle being turned on![line break][variable custom style]Uh-oh...[roman type][line break]The needle brings stinging pain with it as it engages with your snkle.";
	PainUp 1;
	summon spank-me-heart tattoo;
	say "A few minutes later, you have a brand new tattoo.";
	try examining spank-me-heart tattoo;
	say "[variable custom style]No way... and this is permanent??[roman type][line break]";
	if diaper quest is 0, say "The [man of shopkeeper] leaves the way [he of shopkeeper] came, mumuring to [himself of shopkeeper] about a job well done.".


maths-timer is a number that varies. maths-timer is -100.

To render timer image (F - a figure-name) with background (N - a number):
	let W be the width of the map-window;
	let H be the height of the map-window;
	[Calculate background image size]
	let XRatio be (W * 1.0) / the pixel-width of F;
	let YRatio be (H * 1.0) / the pixel-height of F;
	let FXi be W;
	let FYi be H;
	if XRatio < YRatio:
		let FY be the pixel-height of F * XRatio;
		now FYi is FY to the nearest whole number;
	otherwise:
		let FX be the pixel-width of F * YRatio;
		now FXi is FX to the nearest whole number;
	let Xi be (W - FXi) / 2; [centre horizontally]
	let Yi be (H - FYi) / 2; [centre vertically]
	draw a rectangle N in the map-window at 0 by 0 with size W by H;
	display the image F in the map-window at Xi by Yi with dimensions FXi by FYi.

Figure of timer 1 is the file "Map/Timer/timer1.png".
Figure of timer 2 is the file "Map/Timer/timer2.png".
Figure of timer 3 is the file "Map/Timer/timer3.png".
Figure of timer 4 is the file "Map/Timer/timer4.png".
Figure of timer 5 is the file "Map/Timer/timer5.png".

Glulx input handling rule for a timer-event:
	if maths-timer > 0:
		decrease maths-timer by 1;
		if maths-timer >= 4:
			render timer image Figure of Timer 1 with background 16776960; [yellow]
		otherwise if maths-timer is 3:
			render timer image Figure of Timer 2 with background 16755200; [orangeyellow]
		otherwise if maths-timer is 2:
			render timer image Figure of Timer 3 with background 16733440; [orangered]
		otherwise if maths-timer is 1:
			render timer image Figure of Timer 4 with background lightModeFullRed; [red]
		otherwise:
			render timer image Figure of Timer 5 with background (TQcolour of violet); [violet]
			let W be the current focus window;
			focus the main window;
			say "[bold type]The timer runs out - you've failed to press any button at all![roman type] Press any key to continue.";
			focus W.



To execute (MSP - maths-sex-predicament):
	now Predicament01 is discovered;
	now the player is in Predicament01;
	say "You find yourself on your hands and knees, stuck in a hole-in-a-wall! The only item of clothing on your entire body is a [if diaper quest is 1]big thick white diaper[otherwise]string belt on your waist[end if]. In front of you sits a control panel with five buttons, labelled from 1 to 5.[line break][first custom style]'WELCOME TO THIS MATHEMATICS-THEMED [']EXTRA CREDIT['] CLASS. SIX INSTRUCTIONS WILL BE PRESENTED IN FRONT OF YOU. THE OPTION YOU CHOOSE WILL BE DISPLAYED ON THE MONITOR ABOVE YOUR LOWER HALF, AND [if diaper quest is 1]EXECUTED BY THE AUTOMATED ROBOTIC ARMS[otherwise]READ BY THE OBEDIENT INSTRUCTION UNDERTAKER WAITING[end if] IN THE ROOM BEHIND YOU, FILMED, AND UPLOADED TO THE INTERNET. THIS WILL OCCUR FIVE TIMES. APOLOGIES, THE INSTRUCTION NUMBER GENERATOR APPEARS TO BE SLIGHTLY MALFUNCTIONING; NUMBERS ARE DISPLAYED IN THE FORM OF MATHEMATICAL SUMS. THERE IS A STRICT TIME LIMIT FOR EACH INSTRUCTION.[paragraph break]'GO.'[paragraph break][variable custom style]Holy crap...[roman type][line break]";
	now the stance of the player is 1;
	if diaper quest is 0:
		if string-belt is not worn, summon string-belt cursed;
		now the quest of string-belt is predicament-quest;
	otherwise:
		summon plain-largish-diaper cursed;
		now the quest of plain-largish-diaper is predicament-quest;
	let D be game difficulty - 1;
	repeat with N running from 1 to 5:
		let LM be the list of appropriate maths-sex-predicament-punishments;
		sort LM in random order;
		truncate LM to 4 entries;
		add leave-me-alone to LM;
		sort LM in random order;
		let LN be {1, 2, 3, 4, 5};
		sort LN in random order;
		let NP be 1;
		repeat with P running through maths-sex-predicament-puzzle:
			now the maths-answer of P is entry NP of LN;
			if entry NP of LM is leave-me-alone, set up P with difficulty D * 2;
			otherwise set up P with difficulty D / 2;
			increase NP by 1;
		say "[if diaper quest is 0]You hear the sound of the door opening and closing, as [one of]a[or]another[stopping] [man of shopkeeper] walks into the room behind you. [end if]Six new instructions appear on the panel, and the timer immediately starts ticking down! Are you ready to see the options? (The timer will start when you press yes).";
		now temporaryYesNoBackground is Figure of maths predicament;
		while the player is not consenting:
			say "Just press yes when you are ready.";
		now temporaryYesNoBackground is Figure of small image;
		request repeating Glk timer event at 3000 milliseconds;
		now maths-timer is 5;
		let E be 0;
		repeat with M running through LM:
			increase E by 1;
			repeat with P running through maths-sex-predicament-puzzle:
				if the maths-answer of P is entry E of LN, say "[puzzle-text of P]: ";
			say "'[maths-punishment-description of M].'[line break]";
		say "Timeout: 'Do what you like.'[paragraph break]";
		say "Time is running out! What numbered button do you press!?[paragraph break][link]1[end link] [link]2[end link] [link]3[end link] [link]4[end link] [link]5[end link][line break]";
		let CLTR be 1000;
		while CLTR is 1000:
			try looking;
			if the focus-window is g-present, display focus stuff;
			let CLTR be the chosen letter - 48;
			if maths-timer > 0 and (CLTR < 1 or CLTR > 5):
				say "[bold type]Input not understood.[roman type] Please choose a number between 1 and 5.";
				now CLTR is 1000;
		say "[if CLTR < 999]As you press the button[otherwise]After the timer runs out[end if], the maths sums reveal their answers.[paragraph break]";
		let E be 0;
		let ELM be 1;
		repeat with M running through LM:
			increase E by 1;
			if CLTR is entry E of LN, now ELM is E;
			say "[if CLTR is entry E of LN][bold type][end if][entry E of LN]: '[maths-punishment-description of M].'[roman type][line break]";
		say "[if maths-timer <= 0][bold type][end if]Timeout: 'Do what you like.'[roman type][line break]The instruction in bold has just been sent to the screen above your [if diaper quest is 0]exposed ass, and is now being read by the [man of shopkeeper] who has been waiting there for [his of shopkeeper] instruction[otherwise]butt[end if].";
		reset the Glulx timer;
		if maths-timer > 0:
			now maths-timer is 0;
			let M be entry ELM of LM;
			maths-execute M;
			if M is leave-me-alone, increase D by 1;
		otherwise:
			let M be condom-anal;
			if the player is female and pregnancy fetish is 1, now M is bareback-vaginal;
			if diaper quest is 1, now M is spank-my-butt-large;
			maths-execute M;
	let PMM be a random pink minimalist monokini;
	if diaper quest is 1, now PMM is a random crybaby T-shirt;
	blandify and reveal PMM;
	now PMM is in the location of the player;
	say "[line break][bold type]The hole-in-the-wall widens, releasing you and allowing you to leave at any time via the door. [roman type]On the ground, you have been left an outfit to return home in: [line break]";
	try examining PMM;
	compute autotaking PMM.






team-enema-predicament is a team-predicament.
Definition: team-enema-predicament is appropriate if the rank of the player >= 4 and diaper quest is 0.
Figure of team enema predicament is the file "Special/Cutscene/cutscene-predicament-team-enema1.jpg".

To execute (TEP - team-enema-predicament):
	let SGO be a random cheeky schoolgirl outfit;
	now SGO is in Predicament01;
	now Predicament01 is discovered;
	now the player is in Predicament01;
	now temporaryYesNoBackground is Figure of team enema predicament;
	let M be team-predicament-partner;
	only destroy SGO;
	say "Your stomach gurgles horribly. You look around... you're in a very small room, with... what the hell?! [BigNameDesc of M] is bound on [his of M] back on top of a bench, completely unable to move thanks to wrist and thigh binds. You're both naked. Underneath the grated floor below your feet is what appears to be two sets of clothes. A ring gag in [NameDesc of M][']s mouth keeps it wide and open, pointing towards the ceiling. A robotic voice speaks over some kind of tannoy.[line break][first custom style]'WELCOME TO THE PINK DIAMOND [']EXTRA CREDIT['] CLASS. BOTH YOUR BELLIES HAVE BEEN FILLED WITH A VOLUMOUS SEMEN ENEMA. IN FIVE MINUTES THE DOOR and YOUR BONDAGE WILL UNLOCK, AND THE CLOTHES BENEATH THE GROUND WILL BE RELEASED. YOUR BELLIES [if watersports fetish is 1]AND BLADDERS [end if]WILL NEED TO BE HELD, OR... OTHERWISE INGESTED... TO PREVENT YOUR CLOTHES FROM BECOMING SOILED.[paragraph break]'GOOD LUCK. YOUR TIME STARTS NOW.'[paragraph break][variable custom style]Uh-oh...[roman type][line break]";
	let T be 300;
	now the semen volume of belly is 30;
	if watersports fetish is 1 and the bladder of the player < 6, now the bladder of the player is 6;
	let SB be 10; [partner's enema]
	let BL be 0; [partner's bladder]
	let L be semen;
	while T > 0:
		let Min be T / 60;
		let S be the remainder after dividing T by 60;
		say "[bold type]The timer screen on the wall currently reads [Min] minute[unless Min is 1]s[end if] and [S] seconds.[roman type][line break]";
		decrease T by 15;
		if the semen volume of belly > 0:
			say "Release your hold on your huge anal creampie?";
			if the player is consenting:
				now the squirt timer of belly is 1;
			otherwise:
				compute enema holding;
			if the squirt timer of belly > 0:
				now the squirt timer of belly is 0;
				say "You can choose to position your [asshole] over [NameDesc of M][']s mouth, if you wish, to force [him of M] to drink it rather than it going down onto your outfits. Do you squat over [NameDesc of M][']s mouth? ";
				if the player is consenting:
					say "[BigNameDesc of M] moans and tries to shake [his of M] head but to no avail. There's nothing [he of M] can do as you squat over [his of M] face and begin to expel a powerful jet stream of asscum into [his of M] wide open mouth. You can hear [him of M] gagging but [he of M] does [his of M] best to swallow it all, gulp after gulp, although you're not sure how much of it is because [he of M] agrees it's the best course of action, and how much of it is because [he of M] needs to swallow it in order to be able to breathe properly.[line break]It takes a number of long painful seconds before the flow of [semen] from your [asshole] begins to peter out, and eventually stops. By the time you're done, you've just forcefed [NameDesc of M] what must be over a litre of thick warm anal creampie.";
					FavourDown M by 3;
				otherwise:
					say "[BigNameDesc of M] squeaks with timid objection as you let it rip, coating both of your outfits in your horrid asscum. It takes a number of long painful seconds before the flow of [semen] from your [asshole] begins to peter out, and eventually stops. By the time you're empty, the clothes are more cum than they are cotton...";
					FavourDown M;
					repeat with C running through clothing in the location of the player:
						now the semen-soak of C is the soak-limit of C;
					PuddleUp semen by 30;
				now the semen volume of belly is 0;
				reset all enema effects;
				now the holding strain of belly is 0;
		if watersports fetish is 1:
			if the player is bursting:
				say "Release your hold on your bladder?";
				if the player is consenting:
					now delayed urination is 2;
				otherwise:
					compute bladder growth;
				if delayed urination > 0:
					say "[if delayed urination is 1]You can't hold it any more!!! You involuntarily[otherwise]You[end if] release your hold on your bladder, and have to make a super quick decision - you can choose to position your [genitals] over [NameDesc of M][']s mouth, if you wish, to force [him of M] to drink it rather than it going down onto your outfits. Do you squat over [NameDesc of M][']s mouth? ";
					if the player is consenting:
						say "[BigNameDesc of M] moans and tries to shake [his of M] head but to no avail. There's nothing [he of M] can do as you squat over [his of M] face and let your [urine] flow into [his of M] wide open mouth. You can hear [him of M] coughing and spluttering but [he of M] does [his of M] best to swallow it all, gulp after reluctant gulp, until eventually [he of M] has drunk your entire bladder-full of [urine], like the perfect urinal.";
						FavourDown M by 2;
					otherwise:
						say "[BigNameDesc of M] lets out a concerned whine as [he of M] hears you emptying your bladder. By the time you're done, the clothing underneath you is completely soaked through with your [urine].";
						FavourDown M;
						repeat with C running through clothing in the location of the player:
							now the urine-soak of C is the soak-limit of C;
						PuddleUp urine by the bladder of the player;
					now delayed urination is 0;
					now the bladder of the player is 0;
			increase BL by 1;
		increase SB by 1;
		repeat with LX running from 1 to 2:
			let L be semen;
			let LN be SB;
			if LX is 2:
				now L is urine;
				now LN is BL;
			if LN > a random number between 6 and 20:
				say "[BigNameDesc of M] wriggles and lets out a panicked 'Eeee!'. You can tell [he of M][']s about to [if L is urine]piss [himself of M][otherwise]expel [his of M] [semen] enema[end if]. There's only one thing you could do to prevent the [variable L] flowing onto the clothing below your feet - you'd have to take it into your mouth. Do you ready your mouth in front of [NameDesc of M][']s crotch? ";
				let WL be 0; [Player relented and liquid goes on clothes?]
				let ML be 0; [Player's mouth has liquid in it?]
				if the player is consenting:
					say "[BigNameDesc of M] sighs with relief as [he of M] hears you collecting [his of M] [variable L] into your mouth rather than letting it soil your outfits.";
					decrease LN by 6;
					while LN > a random number between 0 and 6:
						say "Your mouth is full, but [NameDesc of M][']s flow keeps going! Do you swallow the mouthful of [variable L]? (If you don't, the urine will overflow onto your clothes...) ";
						if the player is consenting:
							say "You shudder with shame as you gulp down the bitter liquid to make space for more in your mouth.";
							if L is urine:
								UrineTasteAddictUp 1;
								StomachUp 3;
							otherwise:
								StomachSemenUp 3;
						otherwise:
							now WL is 1;
						decrease LN by 6;
					now ML is 1;
				otherwise:
					now WL is 1;
				if WL > 0:
					say "[BigNameDesc of M] grunts with what might be disappointment as [his of M] [variable L] audibly gurgles as it makes its way from [his of M] genitals, down to the ground to where it coats both of your outfits.";
					repeat with C running through clothing in the location of the player:
						if L is urine:
							if the urine-soak of C < the soak-limit of C, increase the urine-soak of C by LN;
						otherwise:
							if the semen-soak of C < the soak-limit of C, increase the semen-soak of C by LN;
					PuddleUp L by LN;
					now LN is 0;
					FavourDown M;
				if ML > 0:
					say "Your mouth is full of [NameDesc of M][']s [variable L]! What do you want to do with it? You could swallow it yourself of course, but why do that when you could snowball it into [NameDesc of M][']s mouth and force [him of M] to drink [his of M] own bodily fluids! Do you snowball the [variable L] back into [NameDesc of M][']s mouth? ";
					if the player is consenting:
						say "You keep an expressionless face as you force-kiss [NameDesc of M] and push [his of M] [variable L] back into [his of M] mouth, forcing [him of M] to swallow [his of M] own shame.";
						FavourDown M by 2;
					otherwise:
						say "You shudder with shame as you gulp down the bitter liquid to make space for more in your mouth.";
						if L is urine:
							UrineTasteAddictUp 1;
							StomachUp 3;
						otherwise:
							StomachSemenUp 3;
			if L is urine, now BL is LN;
			otherwise now SB is LN;
		if the stomach-liquid of the player > 3, StomachDown (the stomach-liquid of the player / 3);
	say "As the timer hits 0, a latch on the grate underneath your feet opens, allowing you access to the outfits. [BigNameDesc of M][']s bondage all clicks open, releasing [him of M]. [big he of M] is still having some trouble removing the ring gag from [his of M] jaw, so [he of M] just mutters some frustrated noises towards you before retrieving one of the [ShortDesc of SGO]s and making for the now-unlocked door.";
	try M going north;
	now M is in School01;
	say "It looks like you're going to have to make your way out of here on your own.".






team-quiz-predicament is a team-predicament.
team-quiz-predicament has a number called questionCorrect.
team-quiz-predicament has a number called questionWins. [how many questions has the player gotten correct in a row right now?]
team-quiz-predicament has a number called maxQuestionWins. [what's the most number of questions the player has gotten correct in a row?]
team-quiz-predicament has a number called questionFails. [how many questions has the player gotten wrong?]
team-quiz-predicament has a number called questionExpelled. [has the player let it rip yet?]

Definition: team-quiz-predicament is appropriate:
	if the rank of the player < 3, decide no;
	if diaper quest is 1 and the incontinence of the player >= the max-incontinence of the player, decide no;
	if diaper quest is 0 and the player is male and the size of penis is 0, decide no;
	decide yes.
To set up bystanders for (P - team-quiz-predicament):
	set up 13 bystanders.

To execute (L - team-quiz-predicament):
	now the stance of the player is 1;
	now the questionWins of L is 0;
	now the maxQuestionWins of L is 0;
	now the questionFails of L is 0;
	now the questionExpelled of L is 0;
	let ST be team-predicament-partner;
	summon quiz-partner;
	now the bound-target of quiz-partner is ST;
	now the player is in Predicament01;
	say "Your stomach gurgles horribly. You look around... you're in a very small room, screens on all sides, and with... what the hell?! ";
	if diaper quest is 1:
		if diaper messing >= 7 and asshole is not actually occupied, now rectum is 30;
		let D be a random off-stage diaper;
		if there is an off-stage massive diaper, now D is a random off-stage massive diaper;
		summon D cursed;
		now the quest of D is predicament-quest;
		now the bottom-layer of D is 1;
		now the bottom-layer of quiz-partner is 2;
		say "You are kneeling in front of [NameDesc of ST], wristcuffs connected tightly to thigh binds by short red rope. More red rope connects [NameDesc of ST][']s collar with your anklecuffs via D-rings in your thigh binds, which means that the seat your new large white diaper is pushed into [his of ST] entire face. To complete the predicament, [NameDesc of ST][']s own ankles and thighs are tightly bound together. So, every time you try to crawl around, [he of ST][']ll be forced to follow you and [his of ST] face will be repeatedly smushed into your diaper.[paragraph break]Your [if rectum >= 30 and asshole is not actually occupied]bowels are[otherwise]bladder has[end if] somehow filled to the point where it's actually painful![line break][variable custom style]'Ow ow ow[one of]! What the hell is going on?!'[or]!'[stopping][roman type][line break]";
	otherwise:
		if the player is female and the number of worn clitoris piercing is 0:
			say "You realise you now have a cold metal clitoris piercing. ";
			summon normal clit piercing;
		otherwise if the player is male:
			say "You realise you have a metal ring clamped around the top of your scrotum. It feels weird, and you certainly won't be able to get it off past your balls any time soon. ";
		say "It is somehow stuck attached to a tongue piercing, which in turn is... pierced in [ST][']s mouth.[line break][variable custom style]Uh-oh.[roman type][line break]Yes, that's right, you're on all fours, with [NameDesc of ST] stuck behind you and [his of ST] tongue forced to stretch out as if waiting for a serving from your [asshole]. Your belly gurgles again, and you realise that your innards are indeed completely, painfully full of something goopy and nasty...";
		if watersports fetish is 1, increase the urine volume of belly by 25; [We don't use the AssFull function because we don't want to allow the overflow function]
		if the total fill of belly < belly limit, AssFill (belly limit - total fill of belly);
	say "[first custom style]'WELCOME TO THE RUBY [']EXTRA CREDIT['] CLASS. THERE ARE 60 SECONDS IN BETWEEN QUESTIONS. ANSWER TWO QUESTIONS IN A ROW CORRECTLY TO HAVE YOUR [if diaper quest is 1]BONDAGE[otherwise]PIERCINGS[end if] RELEASED. ANSWER THREE QUESTIONS IN A ROW CORRECTLY TO HAVE THE PROVOCACTIVE OUTFITS RELEASED. ANSWER FOUR QUESTIONS IN A ROW CORRECTLY TO HAVE THE COCKTAIL DRESSES RELEASED. THE GAME ENDS AFTER TWO INCORRECT ANSWERS OR WHEN THE DOOR IS OPENED. REWARDS ARE ONLY DISTRIBUTED AFTER QUESTIONS END.'[paragraph break]'GOOD LUCK. YOUR TIME STARTS NOW.'[paragraph break][variable custom style]Uh-oh...[roman type][line break][BigNameDesc of ST] squeals with anxiety from below you.[line break][speech style of ST]'What?! Oh no! [if ST is nasty student]Don't you dare[otherwise]Please don't[end if] [if diaper quest is 1]go[otherwise]squirt that disgusting stuff out[end if] on my face, [NameBimbo]...'[roman type][line break][BigNameDesc of ST] does not sound amused at all!";
	repeat with Q running through team-quiz-predicament-questions:
		reset Q.

A time based rule (this is the team quiz predicament time rule):
	if current-predicament is team-quiz-predicament:
		if the player is in Predicament01 and the questionFails of team-quiz-predicament < 2 and currently-squirting is 0:
			let L be team-quiz-predicament;
			compute quizQuestion of L;
			if the questionFails of L < 2 and questionExpelled of L is 0:
				say "The screens all around you display the same words, followed by [first custom style]'next question in 59 secs...'[roman type][line break]The minute passes by so painfully slowly! You feel your [if diaper quest is 1 and (diaper messing < 7 or asshole is actually occupied)]bladder[otherwise]sphincter[end if] beg to allow itself to be loosened. You know that if you resist, [if diaper quest is 1]you'll end up a little more incontinent[otherwise]it'll hurt[end if]. Do you hold it in?";
				if the player is consenting:
					say "You hold on with everything that you've got.";
					if diaper quest is 1:
						increase incontinence by 1;
						if the incontinence of the player >= the max-incontinence of the player:
							say "But it's no use! ";
							now questionExpelled of L is 1;
					otherwise:
						PainUp 1;
				otherwise:
					now questionExpelled of L is 1;
				if questionExpelled of L is 1:
					now questionExpelled of L is 2;
					if diaper quest is 1:
						compute quiz partner messing;
					otherwise:
						AssSquirt.

Check going north when current-predicament is team-quiz-predicament:
	if the questionFails of team-quiz-predicament < 2 and the player is in Predicament01:
		say "This will end the quiz. Are you sure? ";
		if the player is consenting:
			allocate 3 seconds;
			now the questionFails of team-quiz-predicament is 2;
			say "As you begin to push open the door, the screens change colour to black and the quiz ends.";
			conclude quiz of team-quiz-predicament;
			say "[bold type]You are still in [Predicament01].[roman type][line break]";
		do nothing instead.

To compute quizQuestion of (L - team-quiz-predicament):
	let ST be team-predicament-partner;
	let Q be a random eligible team-quiz-predicament-question;
	if Q is a team-quiz-predicament-question:
		if debugmode > 1, say "Debug info: Chosen [question for Q][line break]";
		set up Q;
		execute Q;
		say "[first custom style]'That's ";
		if the questionCorrect of L is 1:
			increase questionWins of L by 1;
			if questionWins of L > maxQuestionWins of L, now maxQuestionWins of L is questionWins of L;
			say "correct!'[line break][variable custom style][one of]Phew[or]Yes[or]Nice[at random]! That's [if questionWins of L > 1][questionWins of L] in a row[otherwise]one[end if]...[roman type][line break]";
		otherwise:
			increase questionFails of L by 1;
			now questionWins of L is 0;
			let CA be correctAnswer of Q;
			say "incorrect! The correct answer was [if the maxAnswer of Q > 0][CA][otherwise if CA > 0][entry CA of the possible-answers of Q][otherwise] (BUG - no correct answer)[end if].'[roman type][line break]";
	otherwise:
		say "BUG: no valid question found. Abandoning...";
		now questionFails of L is 2;
	if the questionFails of L is 2:
		say "Now that you have gotten two questions incorrect, the screens change colour to black and the quiz ends.";
		conclude quiz of L.

To conclude quiz of (L - team-quiz-predicament):
	let ST be team-predicament-partner;
	if maxQuestionWins of L > 1:
		say "The [if diaper quest is 1]bondage keeping you knelt on top of [NameDesc of ST][']s face disappears[otherwise]piercings separate[end if]! [BigNameDesc of ST] can finally take [his of ST] face away from your ass.";
		if maxQuestionWins of L > 2:
			blandify and reveal backless negligee;
			now backless negligee is in the location of the player;
			say "Two naughty bedroom outfits fall from a container attached to the ceiling!";
			say FullExamineDesc of backless negligee;
			if maxQuestionWins of L > 3:
				let N be a random white slut clubbing dress;
				blandify and reveal N;
				now N is in the location of the player;
				say "Two slutty cocktail dresses fall from another container next to the first!";
			say "[BigNameDesc of ST] grabs one of the [if maxQuestionWins of L > 3]cocktail dresses[otherwise]negligees[end if] and runs out the door as quickly as [he of ST] can.";
		otherwise:
			say "[BigNameDesc of ST] runs out the door as quickly as [he of ST] can.";
		only destroy quiz-partner;
	otherwise:
		say "[BigNameDesc of ST] is still stuck, so has to follow you everywhere!".



A team-quiz-predicament-question is a kind of object.
A team-quiz-predicament-question has a number called askedAlready.
A team-quiz-predicament-question has a list of texts called possible-answers.
A team-quiz-predicament-question has a number called minAnswer.
A team-quiz-predicament-question has a number called maxAnswer.
A team-quiz-predicament-question has a number called correctAnswer.
Definition: a team-quiz-predicament-question is appropriate: decide yes.
Definition: a team-quiz-predicament-question (called Z) is eligible:
	if Z is not appropriate, decide no;
	repeat with Q running through team-quiz-predicament-questions:
		if Q is not Z and the askedAlready of Q < the askedAlready of Z and Q is appropriate, decide no;
	decide yes.
To set up (Q - a team-quiz-predicament-question):
	say "Bug - No function coded for this question.";
To say question for (Q - a team-quiz-predicament-question):
	say "Missing question goes here";
To execute (Q - a team-quiz-predicament-question):
	ask question of Q;
	process answer of Q;

To ask question of (Q - a team-quiz-predicament-question):
	say "[first custom style]'[question for Q]?'[roman type][line break]";
	if the maxAnswer of Q > 0: [number question]
		repeat with N running from the minAnswer of Q to the maxAnswer of Q:
			say "[link][N][end link] ";
		say line break;
	otherwise: [text question]
		let N be 1;
		repeat with T running through the possible-answers of Q:
			say "[link][N]) [T][as][N][end link][line break]";
			increase N by 1.
To process answer of (Q - a team-quiz-predicament-question):
	let CL be -999;
	while CL is -999:
		now CL is the chosen letter - 48;
		if the maxAnswer of Q > 0: [number question]
			if CL < the minAnswer of Q or CL > the maxAnswer of Q:
				now CL is -999;
				say "Input not understood. Press a number between 1 and [the maxAnswer of Q].";
		otherwise:
			if CL < 1 or CL > the number of entries in the possible-answers of Q:
				now CL is -999;
				say "Input not understood. Press a number between 1 and [the number of entries in the possible-answers of Q].";
	if CL is the correctAnswer of Q:
		now the questionCorrect of team-quiz-predicament is 1;
	otherwise:
		now the questionCorrect of team-quiz-predicament is 0.


To reset (Q - a team-quiz-predicament-question):
	truncate the possible-answers of Q to 0 entries;
	now the askedAlready of Q is 0.

To set up number answers for (Q - a team-quiz-predicament-question):
	let R be a random number from -2 to 0;
	if the correctAnswer of Q + R < 0, now R is 0 - the correctAnswer of Q;
	if the correctAnswer of Q + R > 7, now R is 7 - the correctAnswer of Q;
	now the minAnswer of Q is the correctAnswer of Q + R;
	now the maxAnswer of Q is the correctAnswer of Q + R + 2.


quiz-woods-candy is a team-quiz-predicament-question.
Definition: quiz-woods-candy is appropriate if there is a candy machine in a placed jungle room and the askedAlready of it is 0.
To say question for (Q - quiz-woods-candy):
	say "In which of these places in the woods is there a candy machine";
To set up (Q - quiz-woods-candy):
	truncate the possible-answers of Q to 0 entries;
	increase the askedAlready of Q by 1;
	now the correctAnswer of Q is a random number between 1 and 3;
	let N be 1;
	while N <= 3:
		let T be "";
		if N is the correctAnswer of Q:
			repeat with C running through candy machines:
				if C is in a placed jungle room, now T is the substituted form of "[printed name of the location of C]";
			if T is "":
				say "BUG - tried to set up woods candy question and failed to find it.";
			otherwise if T is listed in the possible-answers of Q:
				now N is 0; [start again]
				truncate the possible-answers of Q to 0 entries;
			otherwise:
				add T to the possible-answers of Q;
		otherwise:
			now T is the substituted form of "[printed name of a random placed jungle room]";
			if T is listed in the possible-answers of Q:
				decrease N by 1; [try again]
			otherwise:
				add T to the possible-answers of Q;
		increase N by 1.

quiz-candy is a team-quiz-predicament-question.
Definition: quiz-candy is appropriate:
	if Woods01 is not placed, decide no;
	repeat with C running through candy machines:
		if the recent uses of C > 0, decide yes;
	decide no.
To say question for (Q - quiz-candy):
	say "Which candy machine have you most recently used?";
To set up (Q - quiz-candy):
	increase the askedAlready of Q by 1;
	truncate the possible-answers of Q to 0 entries;
	let N be 1;
	repeat with C running through candy machines:
		if C is in a labyrinth room:
			add "Dungeon" to the possible-answers of Q, if absent;
		otherwise if C is in a jungle room:
			add "Woods" to the possible-answers of Q, if absent;
		otherwise if C is in a modern room:
			add "Hotel" to the possible-answers of Q, if absent;
		otherwise:
			add "Mansion" to the possible-answers of Q, if absent;
		if the recent uses of C > 0, now the correctAnswer of Q is N;
		increase N by 1;


quiz-dog is a team-quiz-predicament-question.
To say question for (Q - quiz-dog):
	say "What's the name of the [ShortDesc of hellhound] that lives in the creepy mansion";
To set up (Q - quiz-dog):
	increase the askedAlready of Q by 1;
	let N be a random number between 1 and 4;
	while N > 1:
		decrease N by 1;
		let T be the substituted form of "[PossiblePetName]"; [So we start listing the names at a random point in the sequence]
	while N < 4:
		let T be the substituted form of "[PossiblePetName]";
		add T to the possible-answers of Q, if absent;
		now N is the number of entries in the possible-answers of Q;
		if T matches the text DogPetName, now the correctAnswer of Q is N;


quiz-fairies is a team-quiz-predicament-question.
Definition: quiz-fairies is appropriate if Woods01 is placed.
To say question for (Q - quiz-fairies):
	say "How many fairies are there in the woods right now";
To set up (Q - quiz-fairies):
	increase the askedAlready of Q by 1;
	now the correctAnswer of Q is the number of alive fairy;
	set up number answers for Q.


quiz-tentacles is a team-quiz-predicament-question.
Definition: quiz-tentacles is appropriate if tentacle fetish is 1 and the number of alive tentacle monsters < 10.
To say question for (Q - quiz-tentacles):
	say "How many tentacle monsters are there in the world right now";
To set up (Q - quiz-tentacles):
	increase the askedAlready of Q by 1;
	now the correctAnswer of Q is the number of alive tentacle monsters;
	set up number answers for Q.


quiz-humans is a team-quiz-predicament-question.
To say question for (Q - quiz-humans):
	say "How many humans are there in the dungeon right now";
To set up (Q - quiz-humans):
	increase the askedAlready of Q by 1;
	now the correctAnswer of Q is the number of human monsters in the dungeon;
	set up number answers for Q.

quiz-junk is a team-quiz-predicament-question.
Definition: quiz-junk is appropriate if the number of clothing in School15 < 10.
To say question for (Q - quiz-junk):
	say "How many items of clothing are there in the junk room right now";
To set up (Q - quiz-junk):
	increase the askedAlready of Q by 1;
	now the correctAnswer of Q is the number of clothing in School15;
	set up number answers for Q.

quiz-wealth is a team-quiz-predicament-question.
Definition: quiz-wealth is appropriate if the wealth of the player > 0 and the wealth of the player < 10.
To say question for (Q - quiz-wealth):
	say "What's the total value of all the jewellery you're wearing";
To set up (Q - quiz-wealth):
	increase the askedAlready of Q by 1;
	now the correctAnswer of Q is the wealth of the player;
	set up number answers for Q.

team-quiz-predicaments is a team-quiz-predicament-question.
Definition: team-quiz-predicaments is appropriate if totalLessonCount < 10.
To say question for (Q - team-quiz-predicaments):
	say "How many lessons have you attended";
To set up (Q - team-quiz-predicaments):
	increase the askedAlready of Q by 1;
	now the correctAnswer of Q is totalLessonCount;
	set up number answers for Q.

quiz-orgasms is a team-quiz-predicament-question.
Definition: quiz-orgasms is appropriate if totalOrgasmCount < 10.
To say question for (Q - quiz-orgasms):
	say "How many orgasms have you had";
To set up (Q - quiz-orgasms):
	increase the askedAlready of Q by 1;
	now the correctAnswer of Q is totalOrgasmCount;
	set up number answers for Q.

quiz-snacks is a team-quiz-predicament-question.
Definition: quiz-snacks is appropriate if snacks-found < 10.
To say question for (Q - quiz-snacks):
	say "How many beneficial snacks have you found in containers";
To set up (Q - quiz-snacks):
	increase the askedAlready of Q by 1;
	now the correctAnswer of Q is snacks-found;
	set up number answers for Q.

quiz-patrons is a team-quiz-predicament-question.
Definition: quiz-patrons is appropriate if patronbed uses > 0 and patronbed uses < 10.
To say question for (Q - quiz-patrons):
	say "How many times have you worked as a [if diaper quest is 1]professional baby slave[otherwise]whore[end if] at a hotel bed";
To set up (Q - quiz-patrons):
	increase the askedAlready of Q by 1;
	now the correctAnswer of Q is patronbed uses;
	set up number answers for Q.

quiz-throne is a team-quiz-predicament-question.
Definition: quiz-throne is appropriate if timesSat of the throne < 10.
To say question for (Q - quiz-throne):
	say "How many times have you sat on the royal throne";
To set up (Q - quiz-throne):
	increase the askedAlready of Q by 1;
	now the correctAnswer of Q is timesSat of the throne;
	set up number answers for Q.







smoothie-predicament is a predicament.
Definition: smoothie-predicament is appropriate if diaper messing > 3 and the rank of the player > 1 and ((diaper quest is 0 and the player is a december 2019 top donator) or (diaper quest is 1 and the player is a december 2019 diaper donator)).
smoothie-predicament has a number called bananas-left.
smoothie-predicament has a number called smoothies-served.
To set up bystanders for (P - smoothie-predicament):
	set up 20 bystanders.



smoothie van is a thing. smoothie van is not portable. The printed name of smoothie van is "[TQlink of item described]smoothie van[TQxlink of item described]". The text-shortcut of smoothie van is "smvn".
To say ExamineDesc of (C - smoothie van):
	say "You are standing inside a mobile van, in front of a serving window, and lots of equipment with which to make smoothies[if there is a bystander in the location of C]. Bystanders can't tell that you are locked in place and diapered[end if].".
Figure of smoothie van opaque is the file "Env/School/smoothievan1.jpg".
Figure of smoothie van X-ray is the file "Env/School/smoothievan2.jpg".
To decide which figure-name is examine-image of (C - smoothie van):
	if there is a bystander in the location of C, decide on figure of smoothie van opaque;
	decide on figure of smoothie van X-ray.


To execute (L - smoothie-predicament):
	now the stance of the player is 0;
	now the fatigue of the player is 0;
	now the bananas-left of smoothie-predicament is 4;
	summon smoothie gag locked;
	now smoothie gag is stuck;
	summon smoothie-apron;
	summon pink-huge-diaper locked;
	now the player is in Predicament03;
	now the stomach-food of the player is 1;
	now the stomach-water of the player is 3;
	now the bladder of the player is 1;
	now the delayed bladder of the player is 0;
	say "Your mouth is forced open by the appearance of a new tube tag. What the hell?! You look around. You are standing inside a mobile van, in front of a serving window, and lots of equipment with which to make smoothies. Your ankles are chained to the ground beneath you, preventing you from leaving - not that your customers will be able to see this. A tube leads upwards from your tube gag to a funnel attached to the top of the window. Anyone could pour liquids down that, and force you to drink them! For clothing, you can see that you are wearing a white top and a green apron that can barely hide the massive pink diaper sitting behind it. You are parked on a road opposite a park. A mechanical voice begins to explain your predicament.[line break][first custom style]'THE RULES ARE AS FOLLOWS: [PredicamentRewardExplanation]TO EARN THIS TROPHY, YOU MUST SIMPLY RETURN HOME - YOUR HOUSE IS ON THE OTHER SIDE OF THIS PARK. SERVE SIX CUSTOMERS TO BE RELEASED. A SIGN ON THE FRONT OF YOUR VAN ENCOURAGES CUSTOMERS WHO ARE NOT ENJOYING THEIR DRINK TO FORCEFEED YOU THE REST. GOOD LUCK.'[PredicamentRewardExplanationReaction][roman type][line break]";
	compute predicament map reveal;
	now smoothie van is in Predicament03; [has to come after the map reveal]
	repeat with M running through alive bystanders:
		set up smoothie stats of M;
	display entire map and refresh icons.

To set up smoothie stats of (M - a bystander):
	now the bystanderInt1 of M is a random number between 0 and 9; [How much will they enjoy the drink?]
	now the bystanderInt2 of M is a random number between -2 and 5. [How much convincing do they need?]

To compute smoothie perception of (M - a bystander):
	let convinceMe be the bystanderInt2 of M;
	let convinceMeFuzzy be convinceMe + a random number between -2 and 2;
	let convincing be 0;
	display entire map and refresh icons;
	if convinceMe > 0:
		say SmoothieConvinceMe convinceMeFuzzy for M;
		say "How would you like to try and convince [him of M] to take a smoothie? [bold type][one of]The[or]Remember, the[stopping] more effort you make to try to convince [him of M] to take a smoothie, the less tolerant [he of M][']ll be if [he of M] doesn't like the taste.[roman type][line break]";
		reset multiple choice questions; [ALWAYS REMEMBER THIS WHEN MAKING A MULTIPLE CHOICE QUESTION]
		set numerical response 1 to "make a noise to try and show you're paying [him of M] attention";
		set numerical response 2 to "make a welcoming noise";
		set numerical response 3 to "try to speak a friendly greeting past your gag, and wave";
		set numerical response 4 to "make a happy humming sound while rubbing your tummy and nodding";
		set numerical response 5 to "make urgent sounds while desperately pointing to the 'SATISFACTION GUARANTEED' sign";
		set numerical response 0 to "do nothing";
		compute multiple choice question;
		now convincing is player-numerical-response;
		decrease convinceMe by convincing;
		if convinceMe <= 0, decrease the bystanderInt1 of M by convincing;
	if convinceMe > 0:
		say "[BigNameDesc of M] ultimately shakes [his of M] head, deciding against it for now.";
	otherwise:
		say "[BigNameDesc of M] seems convinced to try a smoothie. [bold type]You have [if bananas-left of smoothie-predicament is 1]one spare banana[otherwise][bananas-left of smoothie-predicament] spare bananas[end if] remaining. [roman type]How do you make it?";
		reset multiple choice questions; [ALWAYS REMEMBER THIS WHEN MAKING A MULTIPLE CHOICE QUESTION]
		if the bananas-left of smoothie-predicament >= 1, set numerical response 1 to "equal parts oatmeal, prunes and banana - consumes 1 spare banana";
		set numerical response 2 to "higher proportion of oatmeal - a thicker drink makes it a bit more likely [he of M][']ll get full before [he of M] finishes it, and if you are forced to drink any, it'll fill you up a bit more";
		set numerical response 3 to "higher proportion of prunes - additional laxative effects if you are made to drink any";
		if the bananas-left of smoothie-predicament >= 2, set numerical response 4 to "higher proportion of banana - a tastier drink makes it a bit more likely [he of M] will enjoy it - consumes 2 spare bananas";
		compute multiple choice question;
		let CNR be player-numerical-response;
		if debuginfo > 0, say "[input-style]Smoothie check: NPC tastebuds ([bystanderInt1 of M + convincing]) - extra convincing given ([convincing]) ";
		if CNR is 1:
			decrease the bananas-left of smoothie-predicament by 1;
		otherwise if CNR is 2:
			let R be a random number between 1 and 2;
			if debuginfo > 0, say "- flavour penalty ([R]) ";
			decrease the bystanderInt1 of M by R;
			if the bystanderInt1 of M < 5, StomachFoodUp 1;
		otherwise if CNR is 3:
			if the bystanderInt1 of M < 5, increase suppository by 1;
		otherwise:
			let R be a random number between 2 and 4;
			if debuginfo > 0, say "+ flavour bonus ([R]) ";
			increase the bystanderInt1 of M by R;
			decrease the bananas-left of smoothie-predicament by 2;
		if debuginfo > 0, say "= [bystanderInt1 of M] | (4.5) smoothie finish threshold[roman type][line break]";
		compute M drinking CNR;
		say "[big he of M] turns to leave you alone.";
		now the bystanderInt1 of M is -1; [flags that they've already had a drink]
		increase the smoothies-served of smoothie-predicament by 1;
		if the smoothies-served of smoothie-predicament is 6:
			say "You hear a loud 'BEEP' as your restraints are released. You can now [bold type]remove the gag[roman type] and then leave the van.";
			now smoothie gag is unlocked;
			say "Remove the gag immediately? ";
			if the player is consenting, try taking off smoothie gag.



To say SmoothieConvinceMe (N - a number) for (M - a bystander):
	if N <= 0:
		say "[big he of M] [one of]licks [his of M] lips as [he of M] looks at the smoothies, but [he of M] doesn't ask for one[or]looks keen. But then [he of M] checks [his of M] pocket for spare change and looks more hesitant[in random order].";
	otherwise if N is 1:
		say "[big he of M] looks very tempted but doesn't approach you.";
	otherwise if N is 2:
		say "[big he of M] looks undecided about whether [he of M] wants a smoothie.";
	otherwise if N is 3:
		say "[big he of M] reads the signs on your van politely but doesn't approach you.";
	otherwise if N is 4:
		say "[big he of M] glances at you only briefly before losing interest.";
	otherwise if N is 5:
		say "[big he of M] wrinkles [his of M] nose when [he of M] reads the ingredients in your smoothie.";
	otherwise if N > 5:
		say "[big he of M] grimaces with disgust when [he of M] reads the ingredients in your smoothie.".

To compute (M - a bystander) drinking (CNR - a number):
	if the bystanderInt1 of M < 1:
		say "[BigNameDesc of M] takes [if CNR is 2]only a few sips before pulling away, apparently already feeling full[otherwise]one sip and pulls it away, an unpleasant look on [his of M] face[end if]. [big he of M] [one of]has a slightly irritated look[or]has a slight frown[or]has an annoyed look[in random order] on [his of M] face as [he of M] pours the mostly-full cup down the funnel. You are forced to gulp and swallow the entire [if CNR is 2]heavy [end if]drink...[SmoothieDisgusted of M]";
		StomachFoodUp 3;
	otherwise if the bystanderInt1 of M < 3:
		say "[BigNameDesc of M] [if CNR is 2]takes a fair few gulps before pulling away, looking satisfied and full[otherwise]drinks several mouthfuls before [he of M] pulls it away, an undecided look on [his of M] face[end if]. [big he of M] then moves to pour the half-full cup down the funnel. You are forced to gulp and swallow the rest of [his of M] [if CNR is 2]thick and heavy [end if]drink...[SmoothieUnhappy of M]";
		StomachFoodUp 2;
	otherwise if the bystanderInt1 of M < 5:
		say "[BigNameDesc of M] [if CNR is 2]swallows a number of big mouthfuls before eventually pulling away, looking extremely full[otherwise]drinks the majority of the cup before releasing it with a satisfied sigh[end if]. Still, there is a bit left in the cup. [SmoothieAlmostHappy of M]";
		StomachFoodUp 1;
	otherwise:
		say SmoothieHappy of M;

To say SmoothieDisgusted of (M - a bystander):
	say "[line break][speech style of M]'[one of]Satisfaction guaranteed, eh?! This is disgusting[or]This is not my sort of drink at all[or]Yuck[at random].'[roman type][line break]".

To say SmoothieUnhappy of (M - a bystander):
	say "[line break][speech style of M]'[one of]It was okay, I guess[or]I'm not going to lie, I didn't really enjoy it[or]I think I might just not be a fan of prunes. Sorry[at random].'[roman type][line break]".

To say SmoothieAlmostHappy of (M - a bystander):
	say "[big he of M] shrugs before obeying the instructions and pouring the rest down the funnel. You are forced to gulp and swallow the remaining couple of mouthfuls.[line break][speech style of M]'[one of]Sorry, couldn't quite finish it[or]That was good, but just a bit much for me[at random].'[roman type][line break]".

To say SmoothieHappy of (M - a bystander):
	say "[BigNameDesc of M] greedily glups down the entire thing, clearly really enjoying it.[line break][speech style of M]'[one of]Thanks a lot[or]That was great, just as you promised[at random]!'[roman type][line break]".



Predicament World ends here.

